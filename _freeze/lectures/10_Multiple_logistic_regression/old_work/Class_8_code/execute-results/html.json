{
  "hash": "df205667064d54afe16f67e94c43d58a",
  "result": {
    "markdown": "---\ntitle: \"Class 8 Code\"\nauthor: \"Nicky Wakim\"\ndate: \"2023-04-26\"\noutput: html_document\n---\n\n<style type=\"text/css\">\n.main-container {\n  max-width: 850px;\n  margin-left: auto;\n  margin-right: auto;\n}\n</style>\n\n<style type=\"text/css\">\nbody, td {\n   font-size: 16px;\n}\ncode.r{\n  font-size: 16px;\n}\npre {\n  font-size: 16px\n}\n</style>\n\n### Set up for the code\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(epiDisplay)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: foreign\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: survival\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: MASS\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'MASS'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: nnet\n```\n:::\n\n```{.r .cell-code}\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'kableExtra'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /Users/wakim/Library/CloudStorage/OneDrive-OregonHealth&ScienceUniversity/Teaching/Classes/S2024_BSTA_513_613/S2024_BSTA_513\n```\n:::\n\n```{.r .cell-code}\nload(here(\"data\", \"bc_diagnosis.Rda\"))\n```\n:::\n\n\n## Simple Logistic Regression (continued from Class 7)\n\n### Interpreting a continuous independant variable\n\n::: {.cell}\n\n```{.r .cell-code}\nage_glm = glm(Late_stage_diag ~ Age, data = bc, \n               family = binomial())\nsummary(age_glm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Late_stage_diag ~ Age, family = binomial(), data = bc)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -4.504457   0.204000  -22.08   <2e-16 ***\nAge          0.056965   0.003204   17.78   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 11861  on 9999  degrees of freedom\nResidual deviance: 11510  on 9998  degrees of freedom\nAIC: 11514\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\nlogistic.display(age_glm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nLogistic regression predicting Late_stage_diag : 1 vs 0 \n \n                 OR(95%CI)         P(Wald's test) P(LR-test)\nAge (cont. var.) 1.06 (1.05,1.07)  < 0.001        < 0.001   \n                                                            \nLog-likelihood = -5754.8442\nNo. of observations = 10000\nAIC value = 11513.6884\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gmodels)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gmodels'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:epiDisplay':\n\n    ci\n```\n:::\n\n```{.r .cell-code}\nage_10 = estimable(age_glm, c(0,10))\nage_10\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Estimate Std. Error X^2 value DF Pr(>|X^2|)\n(0 10) 0.569645   0.032039   316.119  1          0\n```\n:::\n\n```{.r .cell-code}\nOR_age_10 = exp(c(OR = age_10$Estimate, \n                  L_CI = age_10$Estimate - 1.96*age_10$`Std. Error`, \n                  U_CI = age_10$Estimate + 1.96*age_10$`Std. Error`))\nOR_age_10\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      OR     L_CI     U_CI \n1.767639 1.660051 1.882200 \n```\n:::\n:::\n\n\n## Multiple Logistic Regression\n### Fitting the model\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_bc = glm(Late_stage_diag ~ Race_Ethnicity + Age, data = bc, \n               family = binomial())\n\nsummary(multi_bc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Late_stage_diag ~ Race_Ethnicity + Age, family = binomial(), \n    data = bc)\n\nCoefficients:\n                                                 Estimate Std. Error z value\n(Intercept)                                     -4.564946   0.205093 -22.258\nRace_EthnicityHispanic-Latino                   -0.015424   0.083653  -0.184\nRace_EthnicityNH American Indian/Alaskan Native -0.085704   0.484110  -0.177\nRace_EthnicityNH Asian/Pacific Islander          0.133965   0.083797   1.599\nRace_EthnicityNH Black                           0.357692   0.071789   4.983\nAge                                              0.057151   0.003209  17.811\n                                                Pr(>|z|)    \n(Intercept)                                      < 2e-16 ***\nRace_EthnicityHispanic-Latino                      0.854    \nRace_EthnicityNH American Indian/Alaskan Native    0.859    \nRace_EthnicityNH Asian/Pacific Islander            0.110    \nRace_EthnicityNH Black                          6.27e-07 ***\nAge                                              < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 11861  on 9999  degrees of freedom\nResidual deviance: 11484  on 9994  degrees of freedom\nAIC: 11496\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\n### Wald test for single coefficients\n\n::: {.cell}\n\n```{.r .cell-code}\nwald_test = summary(multi_bc)$coefficients\nrownames(wald_test) = c(\"Intercept\", \"R_E: HL\", \"R_E: NH AIAN\",\n                        \"R_E: NH API\",\"R_E: NH B\", \"Age\")\nround(wald_test, 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Estimate Std. Error z value Pr(>|z|)\nIntercept      -4.565      0.205 -22.258    0.000\nR_E: HL        -0.015      0.084  -0.184    0.854\nR_E: NH AIAN   -0.086      0.484  -0.177    0.859\nR_E: NH API     0.134      0.084   1.599    0.110\nR_E: NH B       0.358      0.072   4.983    0.000\nAge             0.057      0.003  17.811    0.000\n```\n:::\n:::\n\n\n### Likelihood ratio test\n#### Example 1: Age\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_bc = glm(Late_stage_diag ~ Race_Ethnicity + Age, data = bc, \n               family = binomial())\nr_e_bc = glm(Late_stage_diag ~ Race_Ethnicity, data = bc, \n               family = binomial())\nlibrary(lmtest)\nlrtest(multi_bc, r_e_bc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Late_stage_diag ~ Race_Ethnicity + Age\nModel 2: Late_stage_diag ~ Race_Ethnicity\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   6 -5741.8                         \n2   5 -5918.1 -1 352.63  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n#### Example 2: Race and Ethnicity\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_bc = glm(Late_stage_diag ~ Race_Ethnicity + Age, data = bc, \n               family = binomial())\nage_bc = glm(Late_stage_diag ~ Age, data = bc, \n               family = binomial())\nlibrary(lmtest)\nlrtest(multi_bc, age_bc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Late_stage_diag ~ Race_Ethnicity + Age\nModel 2: Late_stage_diag ~ Age\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   6 -5741.8                         \n2   2 -5754.8 -4 26.053  3.087e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n#### Example 3: Race and Ethnicity, and age!\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_bc = glm(Late_stage_diag ~ Race_Ethnicity + Age, data = bc, \n               family = binomial())\nint_bc = glm(Late_stage_diag ~ 1, data = bc, \n               family = binomial())\nlibrary(lmtest)\nlrtest(multi_bc, int_bc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Late_stage_diag ~ Race_Ethnicity + Age\nModel 2: Late_stage_diag ~ 1\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   6 -5741.8                         \n2   1 -5930.5 -5 377.32  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Predicted/Estimated Probability\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata = with(bc, \n               data.frame(Race_Ethnicity = \"NH Asian/Pacific Islander\", \n                          Age = 61.70569))\npred = predict(multi_bc, newdata, se.fit = T, type=\"response\")\n\nLL_CI = pred$fit - qnorm(1-0.05/2) * pred$se.fit\nUL_CI = pred$fit + qnorm(1-0.05/2) * pred$se.fit\nc(Pred = pred$fit, LL = LL_CI, UL = UL_CI)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Pred.1      LL.1      UL.1 \n0.2881421 0.2561626 0.3201216 \n```\n:::\n:::\n\n\n### Interpreting the coefficients\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_bc = glm(Late_stage_diag ~ Race_Ethnicity + Age, data = bc, \n               family = binomial())\nexp(summary(multi_bc)$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                  Estimate Std. Error\n(Intercept)                                     0.01041044   1.227639\nRace_EthnicityHispanic-Latino                   0.98469401   1.087252\nRace_EthnicityNH American Indian/Alaskan Native 0.91786623   1.622730\nRace_EthnicityNH Asian/Pacific Islander         1.14335257   1.087408\nRace_EthnicityNH Black                          1.43002563   1.074428\nAge                                             1.05881593   1.003214\n                                                     z value Pr(>|z|)\n(Intercept)                                     2.155229e-10 1.000000\nRace_EthnicityHispanic-Latino                   8.316160e-01 2.348347\nRace_EthnicityNH American Indian/Alaskan Native 8.377519e-01 2.361937\nRace_EthnicityNH Asian/Pacific Islander         4.946537e+00 1.116155\nRace_EthnicityNH Black                          1.458499e+02 1.000001\nAge                                             5.433940e+07 1.000000\n```\n:::\n\n```{.r .cell-code}\nexp(confint.default(multi_bc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                      2.5 %     97.5 %\n(Intercept)                                     0.006964561 0.01556125\nRace_EthnicityHispanic-Latino                   0.835787090 1.16013075\nRace_EthnicityNH American Indian/Alaskan Native 0.355389131 2.37058015\nRace_EthnicityNH Asian/Pacific Islander         0.970179894 1.34743578\nRace_EthnicityNH Black                          1.242330768 1.64607797\nAge                                             1.052177788 1.06549596\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
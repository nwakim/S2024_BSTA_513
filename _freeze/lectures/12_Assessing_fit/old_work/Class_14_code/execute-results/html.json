{
  "hash": "1ef270fe2628ccebcd1e348e197b0519",
  "result": {
    "markdown": "---\ntitle: \"Class 14 Code\"\nauthor: \"Nicky Wakim\"\ndate: \"2023-05-24\"\noutput: html_document\n---\n\n<style type=\"text/css\">\n.main-container {\n  max-width: 1100px;\n  margin-left: auto;\n  margin-right: auto;\n}\n</style>\n\n<style type=\"text/css\">\nbody, td {\n   font-size: 16px;\n}\ncode.r{\n  font-size: 16px;\n}\npre {\n  font-size: 16px\n}\n</style>\n\n### Set up for the code\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(epiDisplay)\nlibrary(kableExtra)\nlibrary(ggplot2)\nlibrary(aplore3)\nlibrary(GGally)\nlibrary(mfp)\nsource(\"Logistic_Dx_Functions.R\")\n```\n:::\n\n\n## GLOW study example\nThe GLOW study data is already a part of the `aplore3` package (stands for the \"**Ap**plied **Lo**gistic **Re**gression **3**rd Edition).\n\n::: {.cell}\n\n```{.r .cell-code}\nglow = glow500\n```\n:::\n\n\n## Pearson Residuals\n\n::: {.cell}\n\n```{.r .cell-code}\nglow2 = glow %>% mutate(raterisk2 = factor(raterisk, levels = c(\"Less\", \"Same\", \"Greater\"), \n                                            labels = c(\"Less and Same\", \"Less and Same\", \"Greater\")), \n                        fracture1 = as.numeric(fracture)-1) \ncat_model = glm(fracture1 ~ priorfrac + momfrac + armassist + raterisk2 + momfrac*armassist, \n                 data = glow2, family = \"binomial\")\nsummary(cat_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fracture1 ~ priorfrac + momfrac + armassist + raterisk2 + \n    momfrac * armassist, family = \"binomial\", data = glow2)\n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)              -1.8570     0.1823 -10.186  < 2e-16 ***\npriorfracYes              0.8948     0.2338   3.828 0.000129 ***\nmomfracYes                0.9969     0.3724   2.677 0.007426 ** \narmassistYes              0.6723     0.2400   2.802 0.005086 ** \nraterisk2Greater          0.3510     0.2314   1.517 0.129324    \nmomfracYes:armassistYes  -0.9101     0.5932  -1.534 0.124987    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 562.34  on 499  degrees of freedom\nResidual deviance: 523.94  on 494  degrees of freedom\nAIC: 535.94\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\n#gof(cat_model)$chiSq\n\n## Still can't find good replacement for LogisticDx package\n```\n:::\n\n\n## Hosmer-Lemeshow Test\n\n::: {.cell}\n\n```{.r .cell-code}\nglow2 = glow %>% mutate(raterisk2 = factor(raterisk, levels = c(\"Less\", \"Same\", \"Greater\"), \n                                            labels = c(\"Less and Same\", \"Less and Same\", \"Greater\"))) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprelim_final = glm(fracture ~ age + height + priorfrac + momfrac + armassist + raterisk2 +\n              age*priorfrac + momfrac*armassist, \n                 data = glow2, family = binomial)\nsummary(prelim_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fracture ~ age + height + priorfrac + momfrac + \n    armassist + raterisk2 + age * priorfrac + momfrac * armassist, \n    family = binomial, data = glow2)\n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)              1.71724    3.32173   0.517 0.605175    \nage                      0.05731    0.01650   3.473 0.000515 ***\nheight                  -0.04674    0.01833  -2.550 0.010781 *  \npriorfracYes             4.61229    1.88018   2.453 0.014163 *  \nmomfracYes               1.24664    0.39296   3.172 0.001512 ** \narmassistYes             0.64416    0.25193   2.557 0.010561 *  \nraterisk2Greater         0.46897    0.24078   1.948 0.051449 .  \nage:priorfracYes        -0.05527    0.02593  -2.132 0.033044 *  \nmomfracYes:armassistYes -1.28054    0.62299  -2.055 0.039834 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 562.34  on 499  degrees of freedom\nResidual deviance: 500.50  on 491  degrees of freedom\nAIC: 518.5\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\nNeed to make sure that the observed outcome, fracture, is in a numeric scale (so takes 0 or 1 values). In the above code, I am using the outcome as a factor, so I will change it here.\n\n::: {.cell}\n\n```{.r .cell-code}\nglow2 = glow2 %>% mutate(frac_num = as.numeric(fracture)-1)\n\nlibrary(ResourceSelection)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nResourceSelection 0.3-6 \t 2023-06-27\n```\n:::\n\n```{.r .cell-code}\nhoslem.test(glow2$frac_num, fitted(prelim_final), g = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tHosmer and Lemeshow goodness of fit (GOF) test\n\ndata:  glow2$frac_num, fitted(prelim_final)\nX-squared = 6.3919, df = 8, p-value = 0.6034\n```\n:::\n:::\n\n\n## ROC Curve and AUC\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(pROC)\n\n\npredicted <- predict(prelim_final, glow2, type=\"response\")\n\n#define object to plot and calculate AUC\nrocobj <- roc(glow2$fracture, predicted)\nauc <- round(auc(glow2$fracture, predicted),4)\n\n#create ROC plot\nggroc(rocobj, colour = 'steelblue', size = 2) +\n  ggtitle(paste0('ROC Curve ', '(AUC = ', auc, ')')) +\n  theme(text = element_text(size = 16)) +\n  xlab(\"False Positive Rate (1 - Specificity)\") +\n  ylab(\"True Positive Rate (Sensitivity)\")\n```\n\n::: {.cell-output-display}\n![](Class_14_code_files/figure-html/unnamed-chunk-7-1.png){width=576}\n:::\n:::\n\n\n## AIC and BIC\n\n::: {.cell}\n\n```{.r .cell-code}\nprelim_final = glm(fracture ~ age + height + priorfrac + \n                     momfrac + armassist + raterisk2 + \n                     age*priorfrac + momfrac*armassist, \n                 data = glow2, family = binomial)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAIC(prelim_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 518.4966\n```\n:::\n\n```{.r .cell-code}\nBIC(prelim_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 556.4281\n```\n:::\n\n```{.r .cell-code}\nprelim_final2 = glm(fracture ~ age + height + priorfrac + \n                      momfrac + armassist + raterisk2 + \n                      age*height, \n                 data = glow2, family = binomial)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAIC(prelim_final2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 525.6843\n```\n:::\n\n```{.r .cell-code}\nBIC(prelim_final2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 559.4012\n```\n:::\n:::\n",
    "supporting": [
      "Class_14_code_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
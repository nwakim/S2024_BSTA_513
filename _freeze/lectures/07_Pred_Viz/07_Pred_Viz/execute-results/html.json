{
  "hash": "7c61c0f7f52a1378e9b64b13f5ec2513",
  "result": {
    "markdown": "---\ntitle: \"Lesson 7: Prediction and Visualization in Simple Logistic Regression\"\nauthor: \"Nicky Wakim\"\ntitle-slide-attributes:\n    data-background-color: \"#C2352F\"\ndate: \"04/22/2024\"\nformat: \n  revealjs:\n    theme: \"../simple_NW.scss\"\n    chalkboard: true\n    slide-number: true\n    show-slide-number: all\n    width: 1955\n    height: 1100\n    footer: \"Lesson 7: Prediction and Visualization in Simple Logistic Regression\"\n    html-math-method: mathjax\n    highlight-style: ayu\nexecute:\n  echo: true\n  freeze: auto  # re-render only when source changes\n---\n\n::: {.cell}\n\n:::\n\n\n# Learning Objectives\n\n1. Make transformation between logistic regression and estimated/predicted probability.\n\n2. Construct confidence interval for predicted probability.\n\n3. Visualize the predicted probability (and its confidence intervals). \n\n\n::: {.cell}\n<style type=\"text/css\">\n.reveal code {\n  max-height: 80% !important;\n}\n</style>\n:::\n\n\n## Recall our example: Late stage breast cancer diagnosis \n\n-   Recall that we fitted a simple logistic regression for late stage breast cancer diagnosis using the predictor, age:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbc_reg = glm(Late_stage_diag ~ Age_c, data = bc, family = binomial)\ntidy(bc_reg, conf.int=T) %>% gt() %>% tab_options(table.font.size = 38) %>%\n  fmt_number(decimals = 3)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"zxqxamxulo\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#zxqxamxulo table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#zxqxamxulo thead, #zxqxamxulo tbody, #zxqxamxulo tfoot, #zxqxamxulo tr, #zxqxamxulo td, #zxqxamxulo th {\n  border-style: none;\n}\n\n#zxqxamxulo p {\n  margin: 0;\n  padding: 0;\n}\n\n#zxqxamxulo .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 38px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#zxqxamxulo .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#zxqxamxulo .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#zxqxamxulo .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#zxqxamxulo .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#zxqxamxulo .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#zxqxamxulo .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#zxqxamxulo .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#zxqxamxulo .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#zxqxamxulo .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#zxqxamxulo .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zxqxamxulo .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#zxqxamxulo .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#zxqxamxulo .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#zxqxamxulo .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zxqxamxulo .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#zxqxamxulo .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#zxqxamxulo .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#zxqxamxulo .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zxqxamxulo .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#zxqxamxulo .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zxqxamxulo .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#zxqxamxulo .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zxqxamxulo .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zxqxamxulo .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zxqxamxulo .gt_left {\n  text-align: left;\n}\n\n#zxqxamxulo .gt_center {\n  text-align: center;\n}\n\n#zxqxamxulo .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#zxqxamxulo .gt_font_normal {\n  font-weight: normal;\n}\n\n#zxqxamxulo .gt_font_bold {\n  font-weight: bold;\n}\n\n#zxqxamxulo .gt_font_italic {\n  font-style: italic;\n}\n\n#zxqxamxulo .gt_super {\n  font-size: 65%;\n}\n\n#zxqxamxulo .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#zxqxamxulo .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#zxqxamxulo .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#zxqxamxulo .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#zxqxamxulo .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#zxqxamxulo .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#zxqxamxulo .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"term\">term</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"estimate\">estimate</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"std.error\">std.error</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"statistic\">statistic</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p.value\">p.value</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"conf.low\">conf.low</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"conf.high\">conf.high</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"term\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">−0.989</td>\n<td headers=\"std.error\" class=\"gt_row gt_right\">0.023</td>\n<td headers=\"statistic\" class=\"gt_row gt_right\">−42.637</td>\n<td headers=\"p.value\" class=\"gt_row gt_right\">0.000</td>\n<td headers=\"conf.low\" class=\"gt_row gt_right\">−1.035</td>\n<td headers=\"conf.high\" class=\"gt_row gt_right\">−0.944</td></tr>\n    <tr><td headers=\"term\" class=\"gt_row gt_left\">Age_c</td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">0.057</td>\n<td headers=\"std.error\" class=\"gt_row gt_right\">0.003</td>\n<td headers=\"statistic\" class=\"gt_row gt_right\">17.780</td>\n<td headers=\"p.value\" class=\"gt_row gt_right\">0.000</td>\n<td headers=\"conf.low\" class=\"gt_row gt_right\">0.051</td>\n<td headers=\"conf.high\" class=\"gt_row gt_right\">0.063</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n \n\n-   Fitted logistic regression model: $$\\text{logit}(\\widehat{\\pi}(Age)) = -0.989 + 0.057 \\cdot Age$$\n\n## Recall our example: Late stage breast cancer diagnosis \n\n-   Fitted logistic regression model: $$\\text{logit}(\\widehat{\\pi}(Age)) = -0.989 + 0.057 \\cdot Age$$\n\n \n \n \n\n-   Now we want to caclulate the predicted/estimated probability from the above fitted model\n\n-   We will need to calculate the predicted probability and its confidence interval\n\n    -   Then we will visualize the fitted probability\n\n# Learning Objectives\n\n::: lob\n1. Make transformation between logistic regression and estimated/predicted probability.\n:::\n\n2. Construct confidence interval for predicted probability.\n\n3. Visualize the predicted probability (and its confidence intervals). \n\n## Predicted Probability\n\n-   We may be interested in predicting probability of having a late stage breast cancer diagnosis for a specific age.\n-   The predicted probability is the estimated probability of having the event for given values of covariate(s)\n-   In simple logistic regression, the fitted model is:$$\\text{logit}(\\widehat{\\pi}(X)) = \\hat{\\beta}_0 +{\\hat{\\beta}}_1X $$\n\n-   We can convert it to the predicted probability: $$\\hat{\\pi}\\left(X\\right)=\\frac{\\exp({\\hat{\\beta}}_0+{\\hat{\\beta}}_1X)}{1+\\exp({\\hat{\\beta}}_0+{\\hat{\\beta}}_1X)}$$\n\n    -   This is an inverse logit calculation\n\n-   We can calculate this using the the `predict()` function like in BSTA 512\n\n    - Another option: taking inverse logit of fitted values from `augment()` function\n\n## Reference: Inverse logit\n\n-   If we have $\\text{logit}(a) = b$, then $$\\begin{aligned}\n\\text{logit}(a) & = b \\\\\n\\text{log}\\left(\\dfrac{a}{1-a}\\right) & = b \\\\\n\\exp \\left[ \\text{log}\\left(\\dfrac{a}{1-a}\\right) \\right] & = \\exp[b] \\\\\n\\dfrac{a}{1-a} & = \\exp[b] \\\\\na & = \\exp[b]\\cdot(1-a) \\\\\na & = \\exp[b] - a\\cdot \\exp[b] \\\\\na +  a\\cdot \\exp[b]& = \\exp[b] \\\\\na\\cdot ( 1 + \\exp[b] )& = \\exp[b] \\\\\na& = \\dfrac{\\exp[b]}{1 + \\exp[b]} \\\\\n\\end{aligned}$$\n\n# Learning Objectives\n\n1. Make transformation between logistic regression and estimated/predicted probability.\n\n::: lob\n2. Construct confidence interval for predicted probability.\n:::\n\n3. Visualize the predicted probability (and its confidence intervals). \n\n## Confidence Interval of Predicted Probability\n\n-   Not as easy to construct\n-   I have searched around for a function that does this for us, but I cannot find one\n-   So we have to construct the confidence interval \"by hand\"\n\n \n\nThere are a two ways to do this:\n\n1. Construct the 95% confidence interval in the logit scale, then convert to probability scale\n2. Use Normal approximation (if appropriate) to construct confidence interval in probability scale\n\n## Option 1: 95% confidence interval in logit scale (1/2)\n\n-   Recall our our *fitted* simple logistic regression model with a continuous predictor $$\\text{logit}(\\widehat{\\pi}(X)) = \\widehat{\\beta}_0 + \\widehat{\\beta}_1 \\cdot X$$\n\n-   We can first find the predicted $\\text{logit}(\\widehat{\\pi}(X))$ and then find the 95% confidence interval around it: $$\\text{logit}(\\widehat{\\pi}(X)) \\pm 1.96 \\cdot SE_{\\text{logit}(\\widehat{\\pi}(X))}$$\n\n-   We'll call this 95% CI: $$\\left(\\text{logit}(\\widehat{\\pi}(X)) - 1.96 \\cdot SE_{\\text{logit}(\\widehat{\\pi}(X))}, \\ \\text{logit}(\\widehat{\\pi}(X)) + 1.96 \\cdot SE_{\\text{logit}(\\widehat{\\pi}(X))} \\right)$$\n$$\\left(\\text{logit}_{L}, \\ \\text{logit}_{U} \\right)$$\n\n## Option 1: 95% confidence interval in logit scale (2/2)\n\n-   Then we need to convert to the probability scale\n\n-   To convert from $\\text{logit}(\\widehat{\\pi}(X))$ to $\\widehat{\\pi}(X)$, we take the inverse logit\n\n-   Thus, 95% CI in the probability scale is: \n$$\\left(\\dfrac{\\exp\\left[\\text{logit}_{L}\\right]}{1 + \\exp\\left[\\text{logit}_{L}\\right]}, \\ \\dfrac{\\exp\\left[\\text{logit}_{U}\\right]}{1 + \\exp\\left[\\text{logit}_{U}\\right]} \\right)$$\n\n\n## Option 2: Using Normal approximation\n\n-   If we meet the Normal approximation criteria, we can construct our confidence interval directly in the probability scale\n\n    -   We can use the Normal approximation if: \n    \n        -   $\\widehat{p}n = \\widehat{\\pi}(X)\\cdot n > 10$ and \n        -   $(1-\\widehat{p})n = (1-\\widehat{\\pi}(X))\\cdot n > 10$\n\n \n\n-   We can first find the predicted $\\widehat{\\pi}(X)$ and then find the 95% confidence interval around it: $$\\widehat{\\pi}(X) \\pm 1.96 \\cdot SE_{\\widehat{\\pi}(X)}$$\n\n## Example: Late stage breast cancer diagnosis\n\n::: example\n::: ex-title\nPredicting probability of late stage breast cancer diagnosis\n:::\n::: ex-cont\nFor someone 50 years old, what is the predicted probability for late stage breast cancer diagnosis (with confidence intervals)?\n:::\n:::\n\n**Needed steps:**\n\n1. Calculate probability prediction\n2. Check if we can use Normal approximation\n3. Calculate confidence interval\n\n    a.   Using logit scale then converting\n    b.   Using Normal approximation \n    \n4. Interpret results\n\n## Example: Late stage breast cancer diagnosis\n\n::: example\n::: ex-title\nPredicting probability of late stage breast cancer diagnosis\n:::\n::: ex-cont\nFor someone 50 years old, what is the predicted probability for late stage breast cancer diagnosis (with confidence intervals)?\n:::\n:::\n\n1. Calculate probability prediction\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbc_reg = glm(Late_stage_diag ~ Age_c, data = bc, family = binomial)\nnewdata = data.frame(Age_c = 60 - mean_age)\npred1 = predict(bc_reg, newdata = newdata, se.fit = T, type = \"response\")\npred1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$fit\n        1 \n0.2522616 \n\n$se.fit\n          1 \n0.004709743 \n\n$residual.scale\n[1] 1\n```\n:::\n:::\n\n\n## Example: Late stage breast cancer diagnosis\n\n::: example\n::: ex-title\nPredicting probability of late stage breast cancer diagnosis\n:::\n::: ex-cont\nFor someone 50 years old, what is the predicted probability for late stage breast cancer diagnosis (with confidence intervals)?\n:::\n:::\n\n2. Check if we can use Normal approximation\n\nWe can use the Normal approximation if: $\\widehat{p}n = \\widehat{\\pi}(X)\\cdot n > 10$ and $(1-\\widehat{p})n = (1-\\widehat{\\pi}(X))\\cdot n > 10$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn = nobs(bc_reg)\np = pred1$fit\nn*p\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       1 \n2522.616 \n```\n:::\n\n```{.r .cell-code}\nn*(1-p)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       1 \n7477.384 \n```\n:::\n:::\n\nWe can use the Normal approximation!\n\n\n## Example: Late stage breast cancer diagnosis\n\n::: example\n::: ex-title\nPredicting probability of late stage breast cancer diagnosis\n:::\n::: ex-cont\nFor someone 50 years old, what is the predicted probability for late stage breast cancer diagnosis (with confidence intervals)?\n:::\n:::\n\n3a. Calculate confidence interval (Option 1: logit scale, we could skip previous step)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred1 = predict(bc_reg, newdata = newdata, se.fit = T, type = \"link\")\nLL_CI1 = pred1$fit - qnorm(1-0.05/2) * pred1$se.fit\nUL_CI1 = pred1$fit + qnorm(1-0.05/2) * pred1$se.fit\npred_link = c(Pred = pred1$fit, LL_CI1, UL_CI1)\n\n(exp(pred_link)/(1+exp(pred_link))) %>% round(., digits=3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPred.1      1      1 \n 0.252  0.243  0.262 \n```\n:::\n\n```{.r .cell-code}\ninv.logit(pred_link) %>% round(., digits=3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPred.1      1      1 \n 0.252  0.243  0.262 \n```\n:::\n:::\n\n\n## Example: Late stage breast cancer diagnosis\n\n::: example\n::: ex-title\nPredicting probability of late stage breast cancer diagnosis\n:::\n::: ex-cont\nFor someone 50 years old, what is the predicted probability for late stage breast cancer diagnosis (with confidence intervals)?\n:::\n:::\n\n3b. Calculate confidence interval (Option 2: with Normal approximation)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred = predict(bc_reg, newdata = newdata, se.fit = T, type = \"response\")\n\nLL_CI = pred$fit - qnorm(1-0.05/2) * pred$se.fit\nUL_CI = pred$fit + qnorm(1-0.05/2) * pred$se.fit\n\nc(Pred = pred$fit, LL_CI, UL_CI) %>% round(digits=3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPred.1      1      1 \n 0.252  0.243  0.261 \n```\n:::\n:::\n\n\n## Example: Late stage breast cancer diagnosis\n\n::: example\n::: ex-title\nPredicting probability of late stage breast cancer diagnosis\n:::\n::: ex-cont\nFor someone 50 years old, what is the predicted probability for late stage breast cancer diagnosis (with confidence intervals)?\n:::\n:::\n\n4. Interpret results\n\nFor someone who is 60 years old, the predicted probability of late stage breast cancer diagnosis is 0.252 (95% CI: 0.243, 0.261).\n\n## Predicted/Estimated probability\n\n-   Predicted probability is NOT our predicted outcome\n\n    -   We cannot interpret it as the predicted $Y$ for individuals with certain covariate values\n\n    -   Example: our predicted probability does not tell us that one individual will or will not be diagnosed with late stage breast cancer\n\n \n\n-   The predicted probability is the estimate of the mean (i.e., proportion) of individuals at a certain age who are diagnosed with late stage breast cancer\n\n-   We can use the predicted/estimated probability to predict the outcome\n\n## Predicted outcome\n\n-   Typically, the predicted probability is the **most important thing to use in a clinical setting**\n\n \n\n-   If you ever need to **predict the outcome itself** (from logistic regression with binary outcome):\n\n    -   Remember that the predicted probability can be used in a Bernoulli (or Binomial with $n=1$) distribution to find the predicted outcome\n    \n-   If outcome is something like counts, then we would use a Poisson distribution\n\n \n\n-   By putting it back through a Bernoulli/binomial distribution, we are **re-introducing the random component of our observed outcome**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(8392)\nrbinom(n=1, size=1, prob = pred$fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n\n```{.r .cell-code}\nrbinom(n=10, size=1, prob = pred$fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0 0 0 0 1 0 0 0 1 0\n```\n:::\n:::\n\n\n# Learning Objectives\n\n1. Make transformation between logistic regression and estimated/predicted probability.\n\n2. Construct confidence interval for predicted probability.\n\n::: lob\n3. Visualize the predicted probability (and its confidence intervals).\n:::\n\n## We can also make a plot of all the predicted probabilities (1/2)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbc_reg = glm(Late_stage_diag ~ Age_c, data = bc, family = binomial)\nbc_aug = augment(bc_reg)\n```\n:::\n\n\n- Then we plot the fitted values from the fitted model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(boot) # for inv.logit()\nprob_stage = ggplot(data = bc_aug, aes(x=Age_c, y = inv.logit(.fitted))) + \n  # geom_point(size = 4, color = \"#70AD47\", shape = 1) +\n  geom_smooth(size = 4, color = \"#70AD47\") +\n  labs(x = \"Age centered (yrs)\", \n       y = \"Estimated probability of \\n Late stage BC diagnosis\")  + \n  theme_classic() +\n  theme(axis.title = element_text(size = 30), \n        axis.text = element_text(size = 25), \n        title = element_text(size = 30)) +\n  ylim(0, 1)\n```\n:::\n\n\n## We can also make a plot of all the predicted probabilities (2/2)\n\n-   If we are interested in seeing all the predicted probabilities across the sample's age range\n\n-   Note that the probabilities do not need to fill the full range of 0 to 1.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](07_Pred_Viz_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=864}\n:::\n:::\n\n\n## We can add the confidence intervals (1/3)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata2 = data.frame(Age_c = seq(min(bc$Age_c), max(bc$Age_c), by = 0.1))\npred2 = predict(bc_reg, newdata = newdata2, se.fit = T, type = \"link\")\nLL_CI1 = pred2$fit - qnorm(1-0.05/2) * pred2$se.fit\nUL_CI1 = pred2$fit + qnorm(1-0.05/2) * pred2$se.fit\n\nwith_CI = data.frame(Age_c = newdata2$Age_c, \n                     pred = inv.logit(pred2$fit), \n                     LL = inv.logit(LL_CI1), \n                     UL = inv.logit(UL_CI1))\n```\n:::\n\n\n## We can add the confidence intervals (2/3)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprob_stage_CI = ggplot(data = with_CI, aes(x = Age_c)) +\n  geom_ribbon(aes(ymin = LL, ymax = UL), fill = \"grey\") +\n  geom_smooth(aes(x=Age_c, y = pred), size = 1, color = \"#70AD47\") +\n  labs(x = \"Age centered (yrs)\", \n       y = \"Estimated probability of \\n Late stage BC diagnosis\")  + \n  theme_classic() +\n  theme(axis.title = element_text(size = 30), \n        axis.text = element_text(size = 25), \n        title = element_text(size = 30)) +\n  ylim(0, 0.6)\n```\n:::\n\n\n## We can add the confidence intervals (3/3)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](07_Pred_Viz_files/figure-revealjs/unnamed-chunk-14-1.png){width=864}\n:::\n:::\n\n\n## Poll Everywhere Question\n\n\n## Visualization of observed outcome and fitted model{.smaller}\n\n\n::: {.cell}\n\n:::\n\n\n::: columns\n::: {.column width=\"34%\"}\n\n:::\n::: {.column width=\"33%\"}\n$$\\text{logit}(\\widehat{\\pi}(Age)) = -0.989 + 0.057 \\cdot Age$$\n:::\n::: {.column width=\"33%\"}\n$$\\widehat{\\pi}(Age) = \\dfrac{ \\exp \\left[-0.989 + 0.057 \\cdot Age \\right]}{1+\\exp \\left[-0.989 + 0.057 \\cdot Age \\right]}$$\n:::\n:::\n\n\n::: {.cell layout-align=\"left\"}\n::: {.cell-output-display}\n![](07_Pred_Viz_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='left' width=1920}\n:::\n:::\n\n\n## Visualization of odds ratios?\n\n- We will discuss this more on Wednesday when we look at interpretations of ORs\n\n# Learning Objectives\n\n1. Make transformation between logistic regression and estimated/predicted probability.\n\n2. Construct confidence interval for predicted probability.\n\n3. Visualize the predicted probability (and its confidence intervals). \n",
    "supporting": [
      "07_Pred_Viz_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "079b554ed225a8a4325a8ef3b150c723",
  "result": {
    "markdown": "---\ntitle: \"Lesson 4: Measurements of Association and Agreement\"\nauthor: \"Nicky Wakim\"\ntitle-slide-attributes:\n    data-background-color: \"#C2352F\"\ndate: \"04/10/2024\"\nformat: \n  revealjs:\n    theme: \"../simple_NW.scss\"\n    chalkboard: true\n    slide-number: true\n    show-slide-number: all\n    width: 1955\n    height: 1100\n    footer: \"Lesson 4: Measurements of Association and Agreement\"\n    html-math-method: mathjax\n    highlight-style: ayu\nexecute:\n  echo: true\n  freeze: auto  # re-render only when source changes\n---\n\n\n\n## Poll Everywhere Question 1\n\n# Learning Objectives\n\n1.  Identify cases when it is appropriate to use risk difference, relative risk, or odds ratios\n2.  Expand work on contingency tables to evaluate the agreement or reproducibility using Cohen’s Kappa\n\n\n\n::: {.cell}\n<style type=\"text/css\">\n.reveal code {\n  max-height: 80% !important;\n}\n</style>\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n\nAttaching package: 'janitor'\n\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\n\n\nAttaching package: 'rstatix'\n\n\nThe following object is masked from 'package:janitor':\n\n    make_clean_names\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\n\nhere() starts at /Users/wakim/Library/CloudStorage/OneDrive-OregonHealth&ScienceUniversity/Teaching/Classes/S2024_BSTA_513_613/S2024_BSTA_513\n```\n:::\n:::\n\n\n\n## Last class\n\n-   Used contingency tables to test and measure association between two variables\n\n    -   Categorical outcome variable (Y)\n    -   One categorical explanatory variable (X)\n\n-   We looked at risk difference, risk ratio, and odds ratio to measure association\n\n| Measure                    | Estimate                                                                                               |\n|-----------------|------------------------------------------------------|\n| Risk difference            | $$\\widehat{RD} = \\widehat{p}_1 - \\widehat{p}_1 = \\dfrac{n_{11}}{n_1} - \\dfrac{n_{21}}{n_2}$$           |\n| Relative risk / risk ratio | $$\\widehat{RR}=\\dfrac{\\hat{p}_1}{\\hat{p}_2} = \\dfrac{n_{11}/n_1}{n_{21}/n_2}$$                         |\n| Odds ratio                 | $$\\widehat{OR}=\\frac{odds_1}{odds_2}=\\frac{{\\hat{p}}_1/(1-{\\hat{p}}_1)}{{\\hat{p}}_2/(1-{\\hat{p}}_2)}$$ |\n\n-   Discussed how OR will be an important measurement in logistic regression\n\n## A taste of regression for a binary outcome (we will come back to this!!)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogreg = glm(case ~ glucimp, data = SHS, family = binomial)\n```\n:::\n\n\n\n::: columns\n::: {.column width=\"60%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(logreg)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = case ~ glucimp, family = binomial, data = SHS)\n\nCoefficients:\n              Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   -0.52287    0.08969   -5.83 5.55e-09 ***\nglucimpNormal -1.53684    0.12982  -11.84  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1646.3  on 1663  degrees of freedom\nResidual deviance: 1501.3  on 1662  degrees of freedom\nAIC: 1505.3\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\n:::\n\n::: {.column width=\"40%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(epiDisplay)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: foreign\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: survival\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: MASS\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'MASS'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:gtsummary':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:rstatix':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: nnet\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'epiDisplay'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:ggplot2':\n\n    alpha\n```\n:::\n\n```{.r .cell-code}\nlogistic.display(logreg)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nLogistic regression predicting case \n \n                     OR(95%CI)         P(Wald's test) P(LR-test)\nglucimp (cont. var.) 0.22 (0.17,0.28)  < 0.001        < 0.001   \n                                                                \nLog-likelihood = -750.6533\nNo. of observations = 1664\nAIC value = 1505.3066\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n:::\n:::\n\n# Learning Objectives\n\n::: lob\n1.  Identify cases when it is appropriate to use risk difference, relative risk, or odds ratios\n:::\n\n2.  Expand work on contingency tables to evaluate the agreement or reproducibility using Cohen’s Kappa\n\n## Relationship Between RR and OR (1/2)\n\n-   Notice that odds ratio is **not equivalent** to relative risk (or risk ratio)\n\n \n\n-   However, when the **probability of \"success\" is small** (e.g., rare disease), $\\widehat{OR}$ is a nice approximation of $\\widehat{RR}$ $$\\widehat{OR}=\\frac{{\\hat{p}}_1/(1-{\\hat{p}}_1)}{{\\hat{p}}_2/(1-{\\hat{p}}_2)}=\\widehat{RR}\\cdot \\frac{1-\\widehat{p_2}}{1-\\widehat{p_1}}$$\n\n    -   The fraction in the last term of the above expression approximately equals to 1.0 if $\\widehat{p}_1$ and $\\widehat{p}_2$ BOTH quite small (\\< 0.1)\n\n \n\n-   The $\\widehat{OR}$ and $\\widehat{RR}$ are not very close to each other in SHS: diabetes not a rare disease\n\n    -   $\\widehat{OR} = 4.65$\n    -   $\\widehat{RR} = 3.29$\n\n## Relationship Between RR and OR (2/2)\n\n-   An example where a disease rare over the whole sample (\\~1%), but ...\n\n    -   $\\widehat{OR}$ is not a good estimate of $\\widehat{RR}$ in “rare” disease\n\n![](./images/rare_dis.png){fig-align=\"center\"}\n\n-   $\\widehat{p}_1$ is 0.5: thus $\\widehat{OR}$ and $\\widehat{RR}$ are very different\n\n$$\\widehat{RR}=\\frac{0.5}{0.00102}=490 \\text{ and } \\widehat{OR} = \\frac{0.5(1-0.5)}{0.00102(1-0.00102)}=981$$\n\n## Poll Everywhere Question 2\n\n## RR in retrospective case-control study (1/3)\n\n-   In retrospective case-control studies: we **identify cases** (patients with the outcome), then select a number of controls (patients without the outcome)\n\n    -   Case-control study to require **much smaller sample size** than equivalent cohort studies\n\n    -   So we pick out the cases and controls first, **then see if there is exposure**\n\n \n\n-   However, the [proportion of cases in the sample]{style=\"color:#70AD47; font-weight: bold;\"} **does not** represent the [proportion of cases in the population]{style=\"color:#4472C4; font-weight: bold;\"}\n\n    -   RR compares probability of the outcome (case) for exposed and unexposed groups\n    -   Number of outcomes has been artificially inflated for case-control study\n\n## RR in retrospective case-control study (2/3)\n\n-   Assume a 1:2 case-control study summarized in below table:\n\n::: columns\n::: {.column width=\"15%\"}\n:::\n\n::: {.column width=\"70%\"}\n![](./images/retro_RR_tab1.png){fig-align=\"center\"}\n:::\n\n::: {.column width=\"15%\"}\n:::\n:::\n\n-   Assume we compute the RR as if it is from a cohort study:\n\n$$\\widehat{RR}=\\frac{\\widehat{p_1}}{\\widehat{p_2}}=\\frac{n_{11}/n_{1+}}{n_{21}/n_{2+}}=\\frac{40/80}{60/220}=1.8333$$\n\n## RR in retrospective case-control study (3/3)\n\n-   In real world, the proportion of controls (not diseased) is typically much higher. Assume the table below shows the **proportion in the population in a cohort study**\n\n::: columns\n::: {.column width=\"15%\"}\n:::\n\n::: {.column width=\"70%\"}\n![](./images/retro_RR_tab2.png){fig-align=\"center\"}\n:::\n\n::: {.column width=\"15%\"}\n:::\n:::\n\n-   The estimated RR for the patient population is:\n\n$$\\widehat{RR}=\\frac{\\widehat{p_1}}{\\widehat{p_2}}=\\frac{400/4400}{600/16600}=2.5152$$\n\n## Notes for Odds Ratios\n\n-   The OR is valid for\n\n    -   Case-control studies (where the RR is not appropriate)\n    -   Prospective cohort studies\n    -   Cross-sectional studies\n\n \n\n-   It can be interpreted either as...\n\n    -   Odds of **event** for exposed vs. unexposed individuals, or\n    -   Odds of **exposure** for individuals with vs. without the event of interest\n\n \n\n-   Pay attention to the numerator and denominator for the OR\n\n## OR in retrospective case-control study\n\n-   While we cannot estimate RR from a case-control study, we can still estimate OR for case-control study\n\n    -   OR does not require us to distinguish between the outcome variable and explanatory variable in the contingency table\n\n        -   AKA: Odds ratio of disease comparing exposed to not exposed is same as odds ratio of being exposed comparing diseased and not diseased\n\n \n\n::: columns\n::: column\n-   For case-control study where the probability of having outcome is small, the $\\widehat{OR}$ is a nice approximation to $\\widehat{RR}$\n\n    -   For the 1:2 case-control table: $\\widehat{OR}=\\frac{40\\cdot160}{40\\cdot60} = 2.667$\n\n    -   Population cohort study: $\\widehat{RR}=2.5152$\n:::\n\n::: column\n![](./images/retro_RR_tab1.png){fig-align=\"center\"}\n:::\n:::\n\n## Which measurement should one use?\n\n![](./images/meas_t.png){fig-align=\"center\"}\n\n# Learning Objectives\n\n1.  Identify cases when it is appropriate to use risk difference, relative risk, or odds ratios\n\n::: lob\n2.  Expand work on contingency tables to evaluate the agreement or reproducibility using Cohen’s Kappa\n:::\n\n## Measuring Agreement\n\n-   Still within the realm of contingency tables\n\n-   What if we are NOT looking at the association between two variables?\n\n \n\n-   What if we want to look at the agreement between two things?\n\n    -   Answers of same subjects for same survey taken at different times\n    -   Two different radiologists’ assessment of the same X-ray\n\n \n\n-   Cohen’s Kappa statistics: widely used as a measure of agreement\n\n    -   Example: Reliability studies, interobserver agreement\n\n## Poll Everywhere Question 3\n\n## Let's get our mood data down!\n\n::: columns\n::: {.column width=\"10%\"}\n:::\n\n::: {.column width=\"80%\"}\n![](./images/mood_ct.png){fig-align=\"center\"}\n:::\n\n::: {.column width=\"10%\"}\n:::\n:::\n\n## Measuring Agreement\n\n-   If **perfect agreement** among the two raters/surveys:\n\n    -   We would expect nonzero entries only in the diagonal cells of the table\n\n \n\n-   $p_o$ is the observed proportion of complete agreement (concordance)\n\n-   $p_E$ is the expected proportion of complete agreement if the agreement is just due to chance\n\n-   If the $p_o$ is much greater than $p_E$, then the agreement level is high.\n\n    -   Otherwise, the agreement level is low\n\n \n\n::: columns\n::: {.column width=\"48%\"}\n-   **Cohen's Kappa** is based on the difference between $p_o$ and $p_E$: $$\\hat{\\kappa}=\\frac{p_o-p_E}{1-p_E}$$\n:::\n\n::: {.column width=\"4%\"}\n:::\n\n::: {.column width=\"48%\"}\n-   $\\hat{\\kappa} = 0$: No agreement between surveys/raters other than what would be expected by chance\n-   $\\hat{\\kappa} = 1$: Complete agreement\n:::\n:::\n\n## Measuring Agreement: Cohen's Kappa\n\n::: columns\n::: {.column width=\"52%\"}\n-   Point estimate: $$\\hat{\\kappa}=\\frac{p_o-p_E}{1-p_E}$$\n\n    -   With $p_o=\\ \\frac{\\sum_{i}\\ n_{ii}}{n}$ (sum of diagonals divided by total)\n    -   With $p_E=\\sum_{i}{a_ib_i}$\n    -   With range of point estimate from $[-1, 1]$\n:::\n\n::: {.column width=\"4%\"}\n:::\n\n::: {.column width=\"44%\"}\n::: definition\n::: def-title\nWhat’s $\\sum_{i}{a_ib_i}$?\n:::\n\n::: def-cont\nFor $i$ responses (row/columns), $a_i$ is proportion of $i$ response category in first survey and $b_i$ is proportion of $i$ response category in second survey (we'll show this in the example)\n:::\n:::\n:::\n:::\n\n-   Approximate standard error:\n\n$$ SE_{\\widehat{\\kappa}} = \\sqrt{\\frac{1}{{n\\left(1-p_e\\right)}^2}\\left\\{p_e^2+p_e-\\sum_{i}\\left[a_ib_i\\left(a_i+b_i\\right)\\right]\\right\\}}$$\n\n-   95% Wald confidence interval for $\\widehat{\\kappa}$:\n\n$$\\widehat{\\kappa} \\pm 1.96 \\cdot SE_{\\widehat{\\kappa}}$$\n\n## Example: Our moods (1/3)\n\n::: columns\n::: {.column width=\"68%\"}\n::: example\n::: ex-title\nAgreement of surveys\n:::\n\n::: ex-cont\nCompute the point estimate and 95% confidence interval for the agreement between our Monday and Wednesday moods.\n:::\n:::\n:::\n\n::: {.column width=\"32%\"}\n![](./images/mood_ct.png){fig-align=\"center\"}\n:::\n:::\n\n**Needed steps:**\n\n1.  Compute the kappa statistic\n2.  Find confidence interval of kappa\n3.  Interpret the estimate\n\n## Example: Our moods (2/3)\n\n::: columns\n::: {.column width=\"68%\"}\n::: example\n::: ex-title\nAgreement of surveys\n:::\n\n::: ex-cont\nCompute the point estimate and 95% confidence interval for the agreement between our Monday and Wednesday moods.\n:::\n:::\n:::\n\n::: {.column width=\"32%\"}\n![](./images/mood_ct.png){fig-align=\"center\"}\n:::\n:::\n\n**Needed steps:**\n\n1/2. Compute the kappa statistic and find confidence interval of kappa\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(epiR)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nPackage epiR 2.0.63 is loaded\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nType help(epi.about) for summary information\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nType browseVignettes(package = 'epiR') to learn how to use epiR for applied epidemiological analyses\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n```\n:::\n\n```{.r .cell-code}\nmoods = matrix(c(100, 40, 10, 30), nrow = 2, byrow = T)\nmoods\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     [,1] [,2]\n[1,]  100   40\n[2,]   10   30\n```\n:::\n\n```{.r .cell-code}\nepi.kappa(moods, method = \"cohen\")$kappa \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        est         se     lower     upper\n1 0.3661972 0.07617362 0.2168996 0.5154947\n```\n:::\n:::\n\n\n\n## Example: Our moods (3/3)\n\n::: columns\n::: {.column width=\"68%\"}\n::: example\n::: ex-title\nAgreement of surveys\n:::\n\n::: ex-cont\nCompute the point estimate and 95% confidence interval for the agreement between our Monday and Wednesday moods.\n:::\n:::\n:::\n\n::: {.column width=\"32%\"}\n![](./images/mood_ct.png){fig-align=\"center\"}\n:::\n:::\n\n**Needed steps:**\n\n3.  Interpret the estimate\n\nThe kappa statistic is \\_\\_\\_\\_ (95% CI: \\_\\_\\_\\_\\_, \\_\\_\\_\\_\\_), indicating \\_\\_\\_\\_\\_\\_ agreement.\n\nSince the 95% confidence interval does/does not contain 0, we have/do not have sufficient evidence that there is \\_\\_\\_\\_\\_\\_\\_\\_\\_ agreement between our mood on Monday and our mood on Wednesday.\n\n## Measuring Agreement: Oberved Kappas\n\n-   Guidelines for evaluating Kappa (Rosner TB)\n\n     \n\n    -   **Excellent agreement** if $\\hat\\kappa \\geq 0.75$\n\n     \n\n    -   **Fair to good agreement** if $0.4 < \\hat\\kappa < 0.75$\n\n     \n\n    -   **Poor agreement** if $\\hat\\kappa \\leq 0.4$\n\n \n\nIf $\\hat\\kappa<0$, suggest agreement less than by chance\n\n# Learning Objectives\n\n1.  Identify cases when it is appropriate to use risk difference, relative risk, or odds ratios\n2.  Expand work on contingency tables to evaluate the agreement or reproducibility using Cohen’s Kappa\n\n## Measurement of Association So Far\n\n-   Used contingency tables to test and measure association between two variables\n\n    -   Categorical outcome variable (Y)\n    -   One categorical explanatory variable (X)\n\n-   We looked at risk difference, risk ratio, and odds ratio to measure association\n\n-   Such an association is called crude association\n\n    -   No adjustment for possible confounding factors\n    -   Also called marginal association\n\n-   But we cannot expand analysis based on contingency tables past 3 variables\n\n    -   We can get into stratified contingency tables to bring in a 3rd variable\n    -   But I don't think it's worth it because regression can bring in (adjust for) many variables\n\n# Extra example in case the mood example fails beautifully\n\n## Just in case our data doesn't work out: Beef Consumption in Survey\n\nA diet questionnaire was mailed to 537 female American nurses on two separate occasions several months apart. The questions asked included the quantities eaten of more than 100 separate food items. The data from the two surveys for the amount of beef consumption are presented in the below table. How can reproducibility of response for the beef-consumption data be quantified?\n\n![](./images/beef.png){fig-align=\"center\"}\n\n## Example: Beef Consumption in Survey (1/3)\n\n::: columns\n::: {.column width=\"62%\"}\n::: example\n::: ex-title\nAgreement of surveys\n:::\n\n::: ex-cont\nCompute the point estimate and 95% confidence interval for the agreement between beef consumption surveys. Similar to question: Are results reproducible for the beef-consumption in the survey?\n:::\n:::\n:::\n\n::: {.column width=\"38%\"}\n![](./images/beef.png){fig-align=\"center\"}\n:::\n:::\n\n**Needed steps:**\n\n1.  Compute the kappa statistic\n2.  Find confidence interval of kappa\n3.  Interpret the estimate\n\n## Example: Beef Consumption in Survey (2/3)\n\n::: columns\n::: {.column width=\"62%\"}\n::: example\n::: ex-title\nAgreement of surveys\n:::\n\n::: ex-cont\nCompute the point estimate and 95% confidence interval for the agreement between beef consumption surveys. Similar to question: Are results reproducible for the beef-consumption in the survey?\n:::\n:::\n:::\n\n::: {.column width=\"38%\"}\n![](./images/beef.png){fig-align=\"center\"}\n:::\n:::\n\n**Needed steps:**\n\n1/2. Compute the kappa statistic and find confidence interval of kappa\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(epiR)\nbeef = matrix(c(136, 92, 69, 240), nrow = 2, byrow = T)\nepi.kappa(beef, method = \"cohen\")$kappa \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        est         se     lower     upper\n1 0.3781906 0.04100635 0.2978196 0.4585616\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n\n## Example: Beef Consumption in Survey (3/3)\n\n::: columns\n::: {.column width=\"62%\"}\n::: example\n::: ex-title\nAgreement of surveys\n:::\n\n::: ex-cont\nCompute the point estimate and 95% confidence interval for the agreement between beef consumption surveys. Similar to question: Are results reproducible for the beef-consumption in the survey?\n:::\n:::\n:::\n\n::: {.column width=\"38%\"}\n![](./images/beef.png){fig-align=\"center\"}\n:::\n:::\n\n**Needed steps:**\n\n3.  Interpret the estimate\n\nThe kappa statistic is 0.378 (95% CI: 0.298, 0.459), indicating fair agreement.\n\nSince the 95% confidence interval does not contain 0, we have sufficient evidence that there is fair agreement between the surveys for beef consumption. The survey is not reliably reproducible since we did not achieve excellent agreement.\n",
    "supporting": [
      "04_Meas_Assoc_Agree_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
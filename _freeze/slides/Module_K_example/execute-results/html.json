{
  "hash": "489b560a9e702ae5ae1bab0f9ce46cd4",
  "result": {
    "markdown": "---\ntitle: \"Module_K\"\nauthor: Nicky\ndate: Nov 2, 2021\nfontsize: 10pt\noutput: \n    beamer_presentation\nlatexengine: pdflatex\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell mysize='true'}\n\n:::\n\n## Example: \n+ A common measurement of lung function is the forced expiratory volume (FEV), which measures how much air you can blow out of your lungs in a short period of time. A higher FEV is usually associated with better respiratory function. \nA group of clinicians is interested in examining the factors which affect FEV1. Data on 654 children are available for the following covariates: AGE (A$_i$, years), HEIGHT (H$_i$, inches), MALE (M$_i$=0 for female, 1 for male) SMOKE (S$_i$=0 for non-smoker and 1 for smoker). Each row corresponds to a single clinic visit.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nrm(list=ls())\ndata = read.csv(file=\"fev.csv\",header=T)\nattach(data)\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id A    H M S   fev\n1  1 9 57.0 0 0 1.708\n2  2 8 67.5 0 0 1.724\n3  3 7 54.5 0 0 1.720\n4  4 9 53.0 1 0 1.558\n5  5 9 57.0 1 0 1.895\n6  6 8 61.0 0 0 2.336\n```\n:::\n:::\n\n\n## Compute descriptive statistics on the covariates. Any concerns?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\n# psych::describe(data)\npsych::pairs.panels(data)\n```\n\n::: {.cell-output-display}\n![](Module_K_example_files/figure-html/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\n## Fit a main effects model and obtain  $\\widehat{\\sigma}, \\widehat{Y}_i,\\widehat{\\epsilon}_i,\\widehat{r}_i,\\widehat{r}_{(-i)}$, and $h_{ii}$\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm1 = lm(fev~A+H+M+S)\nm1.yhat = m1$fitted.values\nm1.res = m1$residuals #m1.yhat-fev\nm1.h = hatvalues(m1)  #leverage\nm1.r = rstandard(m1)  #internally studentized residuals\nm1.rr = rstudent(m1)  #externally studentized residuals\n```\n:::\n\n\n## Which subject is most outlying with respect to the X space?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nHmisc::describe(m1.h)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nm1.h \n       n  missing distinct     Info     Mean      Gmd      .05 \n     654        0      376        1 0.007645 0.005121 0.003429 \n     .10      .25      .50      .75      .90      .95 \n0.003566 0.004200 0.005476 0.008427 0.016909 0.019809 \n\nlowest : 0.00309803 0.00313824 0.00318313 0.00321591 0.00321696\nhighest: 0.0286109  0.0300659  0.0311761  0.0322516  0.0413994 \n```\n:::\n\n```{.r .cell-code}\nm1.h[which.max(m1.h)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       652 \n0.04139937 \n```\n:::\n:::\n\n\n## Examine the quartiles of the $\\widehat{\\epsilon}_i$. What do you think?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nHmisc::describe(m1.res)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nm1.res \n        n   missing  distinct      Info      Mean       Gmd       .05 \n      654         0       651         1 6.451e-18    0.4537 -0.655393 \n      .10       .25       .50       .75       .90       .95 \n-0.510275 -0.250333  0.008938  0.255879  0.510772  0.665797 \n\nlowest : -1.37656 -1.32032 -1.17696 -1.13118 -1.07069\nhighest: 1.20594  1.21265  1.4438   1.53025  1.92047 \n```\n:::\n\n```{.r .cell-code}\nHmisc::describe(m1.res)$counts[c(\".25\",\".50\",\".75\")]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        .25         .50         .75 \n\"-0.250333\" \" 0.008938\" \" 0.255879\" \n```\n:::\n:::\n\n\n\n## Do a histogram of the residuals. What do you think?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nhist(m1.res,breaks=15)\n```\n\n::: {.cell-output-display}\n![](Module_K_example_files/figure-html/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Do a Q/Q plot of the residuals. What do you think?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nqq.m1.res = car::qqPlot(m1.res)\n```\n\n::: {.cell-output-display}\n![](Module_K_example_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n\n```{.r .cell-code}\nm1.res[qq.m1.res]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     624      648 \n1.920471 1.530253 \n```\n:::\n:::\n\n\n\n## Compute the $\\widehat{z}_i$ -- this is typically not provided in R or SAS because it is imperfect.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nn = nrow(data); p = m1$rank # dimensions\nm1.sigma = sqrt(  sum(m1.res^2)/(n-p)  )\nm1.z = m1.res/m1.sigma #standardized residual\n```\n:::\n\n\n## For what percentage are (i) $|\\widehat{z}_i|>1$ (ii) $|\\widehat{z}_i|>2$ (iii) $|\\widehat{z}_i|>2.5$\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm1.z.g1 = as.numeric(abs(m1.z)>1); mean(m1.z.g1)*100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 28.74618\n```\n:::\n\n```{.r .cell-code}\nm1.z.g2 = as.numeric(abs(m1.z)>2); mean(m1.z.g2)*100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4.587156\n```\n:::\n\n```{.r .cell-code}\nm1.z.g2.5 = as.numeric(abs(m1.z)>2.5); mean(m1.z.g2.5)*100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.834862\n```\n:::\n:::\n\n\n\n\n## Do partial regression plots. Do you have evidence of non-linear relationships?\n\n::: {.cell mysize='true'}\n\\scriptsize\n\n```{.r .cell-code}\ncar::avPlots(m1)\n```\n\n::: {.cell-output-display}\n![](Module_K_example_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n\n## Residual plots.\n\n::: {.cell mysize='true'}\n\\tiny\n\n```{.r .cell-code}\n#car::residualPlots(m1,type=\"response\")\n```\n:::\n\n\n## Fit a model which replaces HEIGHT with a set of quartiles. Do you have any evidence that the relationship between HEIGHT and FEV1 is non-linear?\n\n::: {.cell mysize='true'}\n\\scriptsize\n\n```{.r .cell-code}\nH.grp = cut(H,breaks=quantile(H, probs=seq(0,1, by=0.25)),include.lowest=T)\nm2 = lm(fev~A+H.grp+M+S)\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = fev ~ A + H.grp + M + S)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4439 -0.2602 -0.0195  0.2677  1.7523 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       0.909792   0.074444  12.221  < 2e-16 ***\nA                 0.104691   0.009246  11.323  < 2e-16 ***\nH.grp(57,61.5]    0.428674   0.052747   8.127 2.24e-15 ***\nH.grp(61.5,65.5]  0.761081   0.061952  12.285  < 2e-16 ***\nH.grp(65.5,74]    1.396289   0.074665  18.701  < 2e-16 ***\nM                 0.164263   0.036378   4.515 7.51e-06 ***\nS                -0.216123   0.063307  -3.414  0.00068 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4357 on 647 degrees of freedom\nMultiple R-squared:  0.7498,\tAdjusted R-squared:  0.7475 \nF-statistic: 323.1 on 6 and 647 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Fit a model which replaces HEIGHT with a set of quartiles. Do you have any evidence that the relationship between HEIGHT and FEV1 is non-linear?\n\n::: {.cell mysize='true'}\n\\scriptsize\n\n```{.r .cell-code}\ncar::avPlots(m2)\n```\n\n::: {.cell-output-display}\n![](Module_K_example_files/figure-html/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n\n### Residual plots.\n\n::: {.cell mysize='true'}\n\\tiny\n\n```{.r .cell-code}\n#car::residualPlots(m2,type=\"response\")\n```\n:::\n\n\n## Fit a model that contains a quadratic term for HEIGHT. Do you have any evidence of non-linearity?\n\n::: {.cell mysize='true'}\n\\scriptsize\n\n```{.r .cell-code}\nH.c = H-median(H,na.rm=T)\nm3 = lm(fev~A+H.c+I(H.c^2)+M+S)\nsummary(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = fev ~ A + H.c + I(H.c^2) + M + S)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.61190 -0.22716  0.00619  0.22418  1.80565 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  1.8489438  0.0959542  19.269  < 2e-16 ***\nA            0.0694646  0.0091089   7.626 8.66e-14 ***\nH.c          0.1101485  0.0046258  23.812  < 2e-16 ***\nI(H.c^2)     0.0031251  0.0004086   7.649 7.35e-14 ***\nM            0.0945352  0.0328613   2.877  0.00415 ** \nS           -0.1332112  0.0571079  -2.333  0.01997 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3951 on 648 degrees of freedom\nMultiple R-squared:  0.794,\tAdjusted R-squared:  0.7924 \nF-statistic: 499.4 on 5 and 648 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Reconcile differences in your conclusions from m2 and m3.\n\n## Compare plots of $\\widehat{Y}_i$ vs $H_i$ based on each of the linear and quadratic models. Does the squared term appear to make a difference to the fitted values?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\npar(mfrow=c(2,3))\nplot(x=H,y=m1$fitted.values,main=\"Yhat vs H in linear term model (m1)\")\nplot(x=fev,y=m1$fitted.values,main=\"Yhat vs Y in linear term model (m1)\")\nplot(x=H,y=m1$residuals,main=\"Residuals vs H in linear term model (m1)\")\nplot(x=H,y=m3$fitted.values,main=\"Yhat vs H in quadratic term model (m3)\")\nplot(x=fev,y=m3$fitted.values,main=\"Yhat vs Y in quadratic term model (m3)\")\nplot(x=H,y=m3$residuals,main=\"Residuals vs H in quadratic term model (m3)\")\ndev.off()\n```\n:::\n\n\n## Compare plots of $\\widehat{Y}_i$ vs $H_i$ based on each of the linear and quadratic models. Does the squared term appear to make a difference to the fitted values?\n\n::: {.cell mysize='true'}\n\\footnotesize::: {.cell-output-display}\n![](Module_K_example_files/figure-html/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "Module_K_example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
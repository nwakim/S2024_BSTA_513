{
  "hash": "1a05e5c0a4b020dfd8b7d3159045c295",
  "result": {
    "markdown": "---\ntitle: \"Module_L\"\nauthor: Xu Shi\ndate: Oct 24, 2020\nfontsize: 10pt\noutput: \n    beamer_presentation\nlatexengine: pdflatex\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell mysize='true'}\n\n:::\n\n## Example: \n+ We return to the data set containing age (measured in days) and birth weight (BWT in ounces) as predictors of infant systolic blood pressure (SBP, mm Hg). \n+ Read in the data file (systolic1.csv). (n = 16)\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nrm(list=ls())\ndata = read.csv(file=\"systolic1.csv\",header=T)\nattach(data)\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  X idno bwt age sbp\n1 1    1 135   3  89\n2 2    2 120   4  90\n3 3    3 100   3  83\n4 4    4 105   2  77\n5 5    5 130   4  92\n6 6    6 125   5  98\n```\n:::\n:::\n\n## Fit a main effects model\n+ sbp = $\\beta_0$ + $\\beta_A*$age + $\\beta_B*$bwt + $\\epsilon$\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm = lm(sbp~age+bwt)\n```\n:::\n\n\n\n## Which subject is most outlying with respect to the covariate space?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm.h = hatvalues(m)\nHmisc::describe(m.h)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nm.h \n       n  missing distinct     Info     Mean      Gmd      .05 \n      16        0       16        1   0.1875   0.1052  0.07389 \n     .10      .25      .50      .75      .90      .95 \n 0.08676  0.11088  0.18910  0.25659  0.28428  0.31395 \n\n0.0697907837801668 (1, 0.062), 0.0752553865370032 (1, 0.062),\n0.0982736316188607 (1, 0.062), 0.110674934201722 (1, 0.062),\n0.110942588214302 (1, 0.062), 0.114957398402998 (1, 0.062),\n0.143841727260561 (1, 0.062), 0.186331801757595 (1, 0.062),\n0.191863318017576 (1, 0.062), 0.201387339965205 (1, 0.062),\n0.220836864879333 (1, 0.062), 0.250568764776732 (1, 0.062),\n0.274657625908908 (1, 0.062), 0.277311861533657 (1, 0.062),\n0.291252174688852 (1, 0.062), 0.382053798456529 (1, 0.062)\n\nFor the frequency table, variable is rounded to the nearest 0\n```\n:::\n\n```{.r .cell-code}\nm.h[which.max(m.h)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       15 \n0.3820538 \n```\n:::\n:::\n\n\n## Using the moderate/large (0.2/0.5) criteria, how many subjects have moderate/large leverage?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm.h[which(m.h>0.5)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnamed numeric(0)\n```\n:::\n\n```{.r .cell-code}\nm.h[which(m.h>0.2)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        4         6         7         9        10        14        15 \n0.2208369 0.2746576 0.2013873 0.2773119 0.2912522 0.2505688 0.3820538 \n```\n:::\n:::\n\n\n## Using the $h_{ii}>2\\overline{h}$ criterion, how many subjects are outlying with respect to $\\boldsymbol{X}$?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm.h[which(m.h>2*mean(m.h))]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       15 \n0.3820538 \n```\n:::\n:::\n\n\n\n## (a) Output influence diagnostics.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm = lm(sbp~age+bwt)\nm.dffits=dffits(m)\nm.dfbeta=dfbeta(m)\nm.D=cooks.distance(m)\nm.covratio=covratio(m)\n```\n:::\n\n## (a) Plot Cookâ€™s distance.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nn = nrow(data); p = m$rank\nplot(m, which=4); abline(h=4/n,lty=2)\n```\n\n::: {.cell-output-display}\n![](Module_L_example_updated_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\n## (a) The plot() function is useful\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\npar(mfrow=c(2,3)) #read more from ?plot.lm\nplot(m,which=1);plot(m,which=2);plot(m,which=3)\nplot(m,which=4);plot(m,which=5);plot(m,which=6)\n```\n\n::: {.cell-output-display}\n![](Module_L_example_updated_files/figure-html/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n## (a) Plot COVRATIO.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nwhich(   (abs(m.covratio-1) > 3*p/n)   )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n 6 10 11 14 15 \n 6 10 11 14 15 \n```\n:::\n\n```{.r .cell-code}\nplot(m.covratio); abline(1+3*p/n,0); abline(1-3*p/n,0)\n```\n\n::: {.cell-output-display}\n![](Module_L_example_updated_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n## (a) Alternatively, the olsrr package\n+ See more at https://olsrr.rsquaredacademy.com/\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nolsrr::ols_plot_dffits(m) # 2*sqrt(p/n) = 0.87\n```\n\n::: {.cell-output-display}\n![](Module_L_example_updated_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## (a) Alternatively, the olsrr package\n+ See more at https://olsrr.rsquaredacademy.com/\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nolsrr::ols_plot_dfbetas(m) # 2/sqrt(n) = 0.5\n```\n\n::: {.cell-output-display}\n![](Module_L_example_updated_files/figure-html/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n## (a) Alternatively, the olsrr package\n+ See more at https://olsrr.rsquaredacademy.com/\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nolsrr::ols_plot_cooksd_chart(m) # 4/n = 0.25\n```\n\n::: {.cell-output-display}\n![](Module_L_example_updated_files/figure-html/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n## (b) What subject has the greatest influence on $\\widehat{\\beta}_A$\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nhead(m.dfbeta)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  (Intercept)         age           bwt\n1  -0.2045439 -0.03108126  0.0031034240\n2   0.1574761 -0.11915728  0.0007786718\n3  -0.4445305  0.01198643  0.0029572369\n4  -1.1931804  0.16776952  0.0043569151\n5   0.4265684 -0.07134988 -0.0023561434\n6   0.3055446 -0.10121075 -0.0001731949\n```\n:::\n\n```{.r .cell-code}\n(ind.max.dfbeta = which.max(abs(m.dfbeta[,\"age\"])))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n10 \n10 \n```\n:::\n\n```{.r .cell-code}\nm.dfbeta[ind.max.dfbeta,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept)         age         bwt \n 5.51250523  0.60524180 -0.05757384 \n```\n:::\n:::\n\n\n## (c) For the subject identified in (b), approximate the value of $\\widehat{\\beta}_A$ if that subject was deleted\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nse.betaA = summary(m)$coef[\"age\",\"Std. Error\"]\nbetak_minus_betakremove = m.dfbeta[,\"age\"]*se.betaA\ncoef(m)[\"age\"]-betak_minus_betakremove[ind.max.dfbeta]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     age \n5.476031 \n```\n:::\n:::\n\n\n## (d) Fit the model without the subject identified in (b). Why $\\widehat{\\beta}_A$ is unequal to that predicted in (c)?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm.remove = lm(sbp~age+bwt,data=data[-ind.max.dfbeta,])\ncoef(m.remove)[\"age\"]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     age \n5.282477 \n```\n:::\n\n```{.r .cell-code}\ncoef(m)[\"age\"]-betak_minus_betakremove[ind.max.dfbeta]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     age \n5.476031 \n```\n:::\n\n```{.r .cell-code}\ncoef(m)[\"age\"]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     age \n5.887719 \n```\n:::\n:::\n\n\n\n## (e) Overall, what subject has the greatest impact on the parameter estimates (in the original model)?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nwhich.max(m.D)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n10 \n10 \n```\n:::\n:::\n\n\n## (f.0) How would you determine which subject has the most influence on the precision of estimation of $\\widehat{\\boldsymbol{\\beta}}$?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nwhich.max(abs(m.covratio-1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n10 \n10 \n```\n:::\n:::\n\n\n## (f) How would you determine which subject has the most influence on $\\widehat{\\sigma}^2$?\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm.h = hatvalues(m)\nm.sigmaratio = m.covratio*(1-m.h)\n(ind.max.sigma = which.max(m.sigmaratio))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n13 \n13 \n```\n:::\n:::\n\n\n\n\n## (g) Approximate the value of $\\widehat{\\sigma}^2$ if the subject with the highest COVARTIO was deleted.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\n(m.sigmaratio[ind.max.sigma])^(1/p)*(summary(m)$sigma)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      13 \n6.655477 \n```\n:::\n:::\n\n\n## (h) Re-fit the model, deleting the subject identified in (g). Compare your answer to that predicted in (g).\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm.remove2 = lm(sbp~age+bwt,data=data[-ind.max.sigma,])\n(summary(m.remove2)$sigma)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6.655477\n```\n:::\n\n```{.r .cell-code}\n(m.sigmaratio[ind.max.sigma])^(1/p)*(summary(m)$sigma)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      13 \n6.655477 \n```\n:::\n\n```{.r .cell-code}\n(summary(m)$sigma)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6.146297\n```\n:::\n:::",
    "supporting": [
      "Module_L_example_updated_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "9ea05d8be2b4844e3b8542982c8b8f27",
  "result": {
    "markdown": "---\ntitle: \"Interactions\"\nauthor: \"Meike Niederhausen and Nicky Wakim\"\ntitle-slide-attributes:\n    data-background-color: \"#213c96\"\ndate: \"02/14/2024\"\ncategories: [\"Week 6\"]\nformat: \n  revealjs:\n    theme: [default, simple_NW.scss]\n    chalkboard: true\n    slide-number: true\n    show-slide-number: all\n    width: 1955\n    height: 1100\n    footer: Interactions\n    html-math-method: mathjax\n    highlight-style: ayu\nexecute:\n  freeze: auto  # re-render only when source changes\n---\n\n\n# Learning Objectives\no Modeling using interactions\no Interpreting parameters of interaction models\no Interactions involving categorical covariates\no Examples\n\n## Let's map that to our regression analysis process\n\n::: box\n![](images/arrow2.png){.absolute top=\"13.5%\" right=\"62.1%\" width=\"155\"} ![](images/arrow2.png){.absolute top=\"13.5%\" right=\"28.4%\" width=\"155\"}![](images/arrow_back4.png){.absolute top=\"7.5%\" right=\"30.5%\" width=\"820\"} ![](images/arrow_down.png){.absolute top=\"60.5%\" right=\"48%\" width=\"85\"}\n\n::: columns\n::: {.column width=\"30%\"}\n::: RAP1\n::: RAP1-title\nModel Selection\n:::\n\n::: RAP1-cont\n-   Building a model\n\n-   Selecting variables\n\n-   Prediction vs interpretation\n\n-   Comparing potential models\n:::\n:::\n:::\n\n::: {.column width=\"4%\"}\n:::\n\n::: {.column width=\"30%\"}\n::: RAP2\n::: RAP2-title\nModel Fitting\n:::\n\n::: RAP2-cont\n-   Find best fit line\n\n-   Using OLS in this class\n\n-   Parameter estimation\n\n-   Categorical covariates\n\n-   Interactions\n:::\n:::\n:::\n\n::: {.column width=\"4%\"}\n:::\n\n::: {.column width=\"30%\"}\n::: RAP3\n::: RAP3-title\nModel Evaluation\n:::\n\n::: RAP3-cont\n-   Evaluation of model fit\n-   Testing model assumptions\n-   Residuals\n-   Transformations\n-   Influential points\n-   Multicollinearity\n:::\n:::\n:::\n:::\n:::\n\n::: RAP4\n::: RAP4-title\nModel Use (Inference)\n:::\n\n::: RAP4-cont\n::: columns\n::: {.column width=\"50%\"}\n-   Inference for coefficients\n-   Hypothesis testing for coefficients\n:::\n\n::: {.column width=\"50%\"}\n-   Inference for expected $Y$ given $X$\n:::\n:::\n:::\n:::\n\n## Multiple Regression: Interaction \n\nConsider a linear regression model with\ntwo covariates: $$\\begin{aligned}\n    Y_i & = & \\beta_0 + \\beta_1X_{i1}+ \\beta_2X_{i2} + \\epsilon_i \\nonumber\n    \\\\\n    E[Y_i|X_{i1},X_{i2}] & = & \\beta_0 + \\beta_1X_{i1}+ \\beta_2X_{i2}\n    \\nonumber\n\\end{aligned}$$\n\nRecall: interpretation of coefficients:\n\n$\\beta_0=$ $E[Y]$, when all covariates equal 0 $\\beta_1=$ mean change in\n$Y$, per unit increase in $X_1$, with $X_2$ held constant\n\nNote: to interpret $\\beta_1$, we did not specify any value of $X_2$;\nonly specified that it be held constant\n\nimplicit assumption: effect of $X_1$ is equal across all values of $X_2$\n\n## Interaction: Description \n\nThe preceding model assumes that $X_{1}$ and\n$X_{2}$ do not *interact* (with respect to their effect on $Y$)\nepidemiology: no \"effect modification\" meaning the effect of $X_{1}$ is\nthe same regardless of the values of $X_{2}$ We can incorporate\ninteractions into our model through product terms:\n$$\\boxed{Y_i  =  \\beta_0 + \\beta_1X_{i1}+ \\beta_2X_{i2} +\n    \\beta_3X_{i1}X_{i2} + \\epsilon_i}$$\n\nTerminology: main effect parameters: $\\beta_1,\\beta_2$\n\ninteraction parameter: $\\beta_3$\n\n## Types of Interactions\n\nCommon types of interactions: : $X_{i1}$ strengthens the $X_{i2}$ effect\n\n: $X_{i1}$ weakens the $X_{i2}$ effect\n\nTo determine *synergism* vs. *antagonism* use model with interaction\nterm look sign of $X_{i1}\\times X_{i2}$ parameter and test significance\nof the interaction coefficient\n\nIf not significant: no evidence of effect modification, i.e., the effect\nof $X_{1}$ does not vary with $X_{2}$\n\nThe main effect models estimate the *average* $X_{i1}$ and $X_{i2}$\neffects\n\n## Interaction Models: Interpretation\n\nQ: How to interpret the parameters in the interaction model?\n\nRecall: main effects model,\n$E[Y_i\\mid X_{i1},X_{i2} ]=\\beta_0 + \\beta_1X_{i1} +\n\\beta_2X_{i2}$\n$$\\frac{\\partial E[Y_i\\mid X_{i1},X_{i2} ]}{\\partial X_{i1}} = \\beta_1$$\ninterpretation of $\\beta_1$ does not involve $X_{i2}$\n\nInteraction model:\n$E[Y_i\\mid X_{i1},X_{i2} ]=\\beta_0 + \\beta_1X_{i1} + \\beta_2X_{i2} +\n\\beta_3X_{i1}X_{i2}$\n$$\\frac{\\partial E[Y_i\\mid X_{i1},X_{i2} ]}{\\partial X_{i1}} = \\beta_1 +\n\\beta_3X_{i2}$$ effect of $X_{i1}$ depends on value of $X_{i2}$ involves\nmore than one coefficient and other covariates\n\n## Interactions: Interpretation\n\nThe \"main effect\\\" in main effects model: $$\\begin{aligned}\n\\beta_1 & = & \\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}} \\nonumber\n\\end{aligned}$$\n\nThe \"main effect\\\" in interaction model: $$\\begin{aligned}\n\\beta_1 & \\neq & \\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}} \\nonumber\n\\end{aligned}$$\n\nin fact, $\\beta_1=$ change in $E[Y]$ per unit increase in $X_{i1}$, when\n$X_{i2}=0$\n\ndepending on the nature of $X_{i2}$, this may be an undesirable\ninterpretation Thus, for interaction model, we have a clear expression\nfor the effect of $X_{i1}$; but, $\\beta_1$ itself *may* have an awkward\ninterpretation Be extremely careful when interpreting the coefficients\nfor the \"main effects\\\" when there is an interaction in the model\n\n## Interactions: Interpretation (continued)\n$E[Y_i\\mid X_{i1},X_{i2} ]=\\beta_0 + \\underbrace{(\\beta_1+\\beta_3X_{i2}) }_\\text{$X_{i1}$'s effect} X_{i1}+ \\underbrace{\\beta_2X_{i2}}_\\text{$X_{i2}$ held constant}$\\\n${\\color{white}{E[Y_i\\mid X_{i1},X_{i2} ]}}=\\beta_0 + \\underbrace{(\\beta_2+\\beta_3X_{i1}) }_\\text{$X_{i2}$'s effect}X_{i3} + \\underbrace{\\beta_1X_{i1}}_\\text{$X_{i1}$ held constant}$\n\nFor the product term, $$\\begin{aligned}\n\\beta_3 & = & {\\color{royalblue}{\\frac{\\partial^2 }{\\partial X_{i1}\\partial\n            X_{i2}}}} E[Y_i\\mid X_{i1},X_{i2}]\\nonumber\n\\end{aligned}$$\n\nInterpretation: $\\beta_3$ = mean change in $X_{i1}$'s effect, per unit\nincrease in $X_{i2}$;\\\n[$\\beta_3$]{style=\"color: white\"} = mean change in $X_{i2}$'s effect,\nper unit increase in $X_{i1}$; where the \"$X_{i1}$ effect\" equals the\nchange in $E[Y]$ per unit increase in $X_{i1}$ with $X_{i2}$ held\nconstant, i.e. \"adjusted $X_{i1}$ effect\\\"\n\nIn summary, the interaction term can be interpreted as \"difference in\nadjusted $X_1$ (or $X_2$) effect per unit increase in $X_2$ (or $X_1$)\\\"\n\n## Interaction between Categorical and Continuous Variables\n\nExample: Pediatric Hypertension: A clinician wishes to examine the\nrelationship between systolic blood pressure (SBP) and covariates age\nand gender\n\nQuestions of interest: For males and females of the same age, is SBP\ndifferent, on average? Is the gender effect on SBP independent of age?\nDoes mean SBP change with age? Is the age effect on SBP the same for\nmales and females?\n\n## Example: Main Effects Model\n\nMain effects model:\n$SBP_i=\\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\epsilon_i$ $A_i=$ age\n(years) $F_i=I($subject $i$ is female) Interpretation of parameters:\n$\\beta_0 =E[SBP|A=0,F=0]$ $\\beta_1 = E[SBP|A=a+1,F=1]  -E[SBP|A=a,F=1]$\n${\\color{white}{\\beta_1}}= E[SBP|A=a+1,F=0]  -E[SBP|A=a,F=0]$\n$\\beta_2  =  E[SBP|A=a,F=1]  - E[SBP|A=a,F=0]$\n\n## Example: Main Effects Model\n\nThe main effects model implies the following relationship: lines have\nsame slope, different intercepts The main effects model assumes no\ninteraction between age and gender w.r.t. SBP\n\n## Example: Interaction Model \n\nInteraction model:\n\n$SBP_i = \\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\beta_3 A_iF_i +\n\\epsilon_i$ Can pose the question of interaction in two ways\n(symmetric): Is the age-adjusted difference in mean SBP between males\nand females constant across all ages?\n$SBP_i = \\beta_0 +  \\underbrace{\\beta_1 A_i}_\\text{age adjusted} + \\underbrace{(\\beta_2 +\\beta_3 A_i)}_\\text{sex effect}  F_i+\n    \\epsilon_i$\n\nIs the sex-adjusted mean change in SBP per year of age equal for males\nand females?\n$SBP_i = \\beta_0 +  \\underbrace{\\beta_2 F_i}_\\text{sex adjusted} + \\underbrace{(\\beta_1+\\beta_3F_i)}_\\text{age effect} A_i +\n\\epsilon_i$\n\n## Example: Interaction Model\n\nThe interaction model implies two separate regression lines\n\n$SBP_i = \\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\beta_3 A_iF_i +\n\\epsilon_i$ For male ($F=0$): $SBP_i = \\beta_0 + \\beta_1 A_i + \n    \\epsilon_i$\n\nFor female ($F=1$):\n\n$SBP_i = (\\beta_0+\\beta_2) + (\\beta_1+\\beta_3)\\; A_i  +\n\\epsilon_i$\n\nThe two lines have different slope, different intercepts\n\n## Example: Interaction Model\n\nThe interaction model implies the following relationship: lines have\ndistinct intercepts and distinct slopes\n\n## Example: Interaction Model\n\nHypothesis testing\n\n$SBP_i = \\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\beta_3 A_iF_i +\n\\epsilon_i$ Question 1: Is the adjusted gender effect on SBP independent\nof age? Is the adjusted age effect on SBP the same for males and\nfemales? How to test for significance of interaction term? $H_0:$ $H_1:$\n$F=$\n\n$T=$\n\n## Example: Interaction Model\n\nHypothesis testing\n\n$SBP_i = \\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\beta_3 A_iF_i +\n\\epsilon_i$ Question 2: Does mean SBP change with age? What about sex?\nHow to test for significance of a covariate, e.g., age?\n$SBP_i = \\beta_0 + (\\beta_1+\\beta_3F_i)  A_i + \\beta_2 F_i +\n\\epsilon_i$ $H_0:$ $H_1:$ $F=$\n\n## Example: Interaction Model\n\nRecall the interaction model implies two separate regression lines\n\n$SBP_i = \\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\beta_3 A_iF_i +\n\\epsilon_i$ For male ($F=0$): $SBP_i = \\beta_0 + \\beta_1 A_i + \n\\epsilon_i$\n\nFor female ($F=1$):\n$SBP_i = (\\beta_0+\\beta_2) + (\\beta_1+\\beta_3)\\; A_i  +\n\\epsilon_i$\n\nHow to calculate 95% CI for age effect among females? Point estimate:\n$\\widehat{\\beta}_1+\\widehat{\\beta}_3$ Standard error:\n$\\text{SE}(\\widehat{\\beta}_1+\\widehat{\\beta}_3)=\\sqrt{\\widehat{Var}(\\widehat{\\beta}_1+\\widehat{\\beta}_3)}=\\sqrt{\\widehat{Var}(\\widehat{\\beta}_1)+\\widehat{Var}(\\widehat{\\beta}_3)+2\\widehat{Cov}(\\widehat{\\beta}_1,\\widehat{\\beta}_3)}$\n:::\n\n\n::: {.cell}\n\n:::\n\n::: {.cell mysize='true'}\n\n:::\n\n## Example: \n+ We return to the data set containing age (measured in days) and birth weight (BWT in ounces) as predictors of infant systolic blood pressure (SBP, mm Hg). \n+ Read in the data file (systolic1.csv). (n = 16)\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\ndata = read.csv(file=\"systolic1.csv\",header=T)\nattach(data)\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  X idno bwt age sbp\n1 1    1 135   3  89\n2 2    2 120   4  90\n3 3    3 100   3  83\n4 4    4 105   2  77\n5 5    5 130   4  92\n6 6    6 125   5  98\n```\n:::\n:::\n\n\n## Fit SBP on AGE x BWT, AGE, BWT in this order\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm1 = lm(sbp~I(age*bwt)+I(age)+I(bwt))\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = sbp ~ I(age * bwt) + I(age) + I(bwt))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.2412 -0.7871 -0.0262  0.8000  3.8433 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)   \n(Intercept)   2.55158   20.83776   0.122  0.90457   \nI(age * bwt) -0.12821    0.05159  -2.485  0.02869 * \nI(age)       21.28730    6.22363   3.420  0.00507 **\nI(bwt)        0.55123    0.17373   3.173  0.00803 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.097 on 12 degrees of freedom\nMultiple R-squared:  0.9214,\tAdjusted R-squared:  0.9017 \nF-statistic: 46.87 on 3 and 12 DF,  p-value: 6.692e-07\n```\n:::\n:::\n\n\n## Compute the sequential and partial SS\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\n( SeqSS.m1 = anova(m1) ) #type I\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: sbp\n             Df Sum Sq Mean Sq  F value    Pr(>F)    \nI(age * bwt)  1 563.17  563.17 128.1049 9.252e-08 ***\nI(age)        1  10.75   10.75   2.4459  0.143809    \nI(bwt)        1  44.26   44.26  10.0674  0.008026 ** \nResiduals    12  52.75    4.40                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n( ParSS.m1 = car::Anova(m1,type=\"III\") ) #type III\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: sbp\n             Sum Sq Df F value   Pr(>F)   \n(Intercept)   0.066  1  0.0150 0.904570   \nI(age * bwt) 27.148  1  6.1753 0.028693 * \nI(age)       51.432  1 11.6991 0.005075 **\nI(bwt)       44.258  1 10.0674 0.008026 **\nResiduals    52.754 12                    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\n## You have two F tests of the interaction. Are either of them valid tests?\n\n\n## Change ordering of covariates and recompute SS\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\n( anova(lm(sbp~I(age)+I(bwt)+I(age*bwt))) ) #type I\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: sbp\n             Df Sum Sq Mean Sq  F value    Pr(>F)    \nI(age)        1 508.82  508.82 115.7405 1.617e-07 ***\nI(bwt)        1  82.22   82.22  18.7024  0.000988 ***\nI(age * bwt)  1  27.15   27.15   6.1753  0.028693 *  \nResiduals    12  52.75    4.40                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n( car::Anova(m1,type=\"III\") ) #type III\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: sbp\n             Sum Sq Df F value   Pr(>F)   \n(Intercept)   0.066  1  0.0150 0.904570   \nI(age * bwt) 27.148  1  6.1753 0.028693 * \nI(age)       51.432  1 11.6991 0.005075 **\nI(bwt)       44.258  1 10.0674 0.008026 **\nResiduals    52.754 12                    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\n## Save the fitted values\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\ndata = cbind(data,fit.m1 = m1$fitted.values)\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       X              idno            bwt             age       \n Min.   : 1.00   Min.   : 1.00   Min.   : 90.0   Min.   :2.000  \n 1st Qu.: 4.75   1st Qu.: 4.75   1st Qu.:105.0   1st Qu.:3.000  \n Median : 8.50   Median : 8.50   Median :120.0   Median :3.000  \n Mean   : 8.50   Mean   : 8.50   Mean   :120.3   Mean   :3.312  \n 3rd Qu.:12.25   3rd Qu.:12.25   3rd Qu.:126.2   3rd Qu.:4.000  \n Max.   :16.00   Max.   :16.00   Max.   :160.0   Max.   :5.000  \n      sbp            fit.m1     \n Min.   :77.00   Min.   :76.08  \n 1st Qu.:82.75   1st Qu.:82.87  \n Median :88.50   Median :88.07  \n Mean   :88.06   Mean   :88.06  \n 3rd Qu.:92.75   3rd Qu.:92.79  \n Max.   :98.00   Max.   :98.21  \n```\n:::\n:::\n\n\n## Hypothesis test of interaction term\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nsummary(lm(sbp~age*bwt))$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Estimate  Std. Error    t value    Pr(>|t|)\n(Intercept)  2.5515809 20.83776184  0.1224499 0.904569568\nage         21.2872960  6.22362825  3.4203997 0.005074825\nbwt          0.5512330  0.17373097  3.1729116 0.008026120\nage:bwt     -0.1282085  0.05159272 -2.4850114 0.028693323\n```\n:::\n\n```{.r .cell-code}\nanova(lm(sbp~age*bwt))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: sbp\n          Df Sum Sq Mean Sq  F value    Pr(>F)    \nage        1 508.82  508.82 115.7405 1.617e-07 ***\nbwt        1  82.22   82.22  18.7024  0.000988 ***\nage:bwt    1  27.15   27.15   6.1753  0.028693 *  \nResiduals 12  52.75    4.40                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Hypothesis test of age\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nnull.model = lm(sbp~bwt)\nalt.model = lm(sbp~age*bwt)\nanova(null.model,alt.model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nModel 1: sbp ~ bwt\nModel 2: sbp ~ age * bwt\n  Res.Df    RSS Df Sum of Sq      F    Pr(>F)    \n1     14 540.40                                  \n2     12  52.75  2    487.65 55.462 8.655e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Compare to the adjusted age effect in an *additive* model \n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\n# car::Anova(lm(sbp~age),type=\"III\") #crude effect\nanova(lm(sbp~bwt),lm(sbp~age+bwt))  #adjusted effect in additive model\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nModel 1: sbp ~ bwt\nModel 2: sbp ~ age + bwt\n  Res.Df   RSS Df Sum of Sq      F    Pr(>F)    \n1     14 540.4                                  \n2     13  79.9  1     460.5 74.923 9.342e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncar::Anova(lm(sbp~age+bwt),type=\"III\") #adjusted effect in additive model\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: sbp\n            Sum Sq Df F value    Pr(>F)    \n(Intercept) 854.98  1 139.104 2.571e-08 ***\nage         460.50  1  74.923 9.342e-07 ***\nbwt          82.22  1  13.377  0.002896 ** \nResiduals    79.90 13                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Hypothesis test of age: by hand\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nSeqSS = data.frame(anova(lm(sbp~I(bwt)+I(age)+I(bwt*age))))\ndf1 = SeqSS[\"I(age)\",\"Df\"]+SeqSS[\"I(bwt * age)\",\"Df\"]\nF1 = (SeqSS[\"I(age)\",\"Sum.Sq\"]+SeqSS[\"I(bwt * age)\",\"Sum.Sq\"])/df1\ndf2 = SeqSS[\"Residuals\",\"Df\"]\nF2 = SeqSS[\"Residuals\",\"Mean.Sq\"]\nc(F.val = F1/F2,\n  P.val = 1 - pf(F1/F2,df1=df1,df2=df2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       F.val        P.val \n5.546241e+01 8.654657e-07 \n```\n:::\n\n```{.r .cell-code}\nanova(null.model,alt.model) ##validate\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nModel 1: sbp ~ bwt\nModel 2: sbp ~ age * bwt\n  Res.Df    RSS Df Sum of Sq      F    Pr(>F)    \n1     14 540.40                                  \n2     12  52.75  2    487.65 55.462 8.655e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Hypothesis test of bwt\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nnull.model = lm(sbp~age)\nalt.model = lm(sbp~age*bwt)\nanova(null.model,alt.model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nModel 1: sbp ~ age\nModel 2: sbp ~ age * bwt\n  Res.Df     RSS Df Sum of Sq      F   Pr(>F)   \n1     14 162.121                                \n2     12  52.754  2    109.37 12.439 0.001187 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\n\n## Center the covariates\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nc(mean(age), sd(age))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3.3125000 0.9464847\n```\n:::\n\n```{.r .cell-code}\nc(mean(bwt), sd(bwt))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 120.3125  18.7500\n```\n:::\n\n```{.r .cell-code}\nage.c = age - mean(age)\nbwt.c = bwt - mean(bwt)\n```\n:::\n\n\n## Fit SBP on AGE x BWT, AGE, BWT, this time using the centered versions of the covariates.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nm2 = lm(sbp~I(age.c*bwt.c)+I(age.c)+I(bwt.c))\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = sbp ~ I(age.c * bwt.c) + I(age.c) + I(bwt.c))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.2412 -0.7871 -0.0262  0.8000  3.8433 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      88.29037    0.53214 165.917  < 2e-16 ***\nI(age.c * bwt.c) -0.12821    0.05159  -2.485 0.028693 *  \nI(age.c)          5.86221    0.57536  10.189 2.93e-07 ***\nI(bwt.c)          0.12654    0.02904   4.357 0.000933 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.097 on 12 degrees of freedom\nMultiple R-squared:  0.9214,\tAdjusted R-squared:  0.9017 \nF-statistic: 46.87 on 3 and 12 DF,  p-value: 6.692e-07\n```\n:::\n:::\n\n\n## Compute the sequential and partial SS\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\n( SeqSS.m2 = anova(m2) ) #type I\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: sbp\n                 Df Sum Sq Mean Sq  F value    Pr(>F)    \nI(age.c * bwt.c)  1  29.83   29.83   6.7843 0.0230268 *  \nI(age.c)          1 504.89  504.89 114.8481 1.687e-07 ***\nI(bwt.c)          1  83.46   83.46  18.9858 0.0009328 ***\nResiduals        12  52.75    4.40                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n( ParSS.m2 = car::Anova(m2,type=\"III\") ) #type III\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: sbp\n                 Sum Sq Df    F value    Pr(>F)    \n(Intercept)      121019  1 27528.3083 < 2.2e-16 ***\nI(age.c * bwt.c)     27  1     6.1753 0.0286933 *  \nI(age.c)            456  1   103.8108 2.925e-07 ***\nI(bwt.c)             83  1    18.9858 0.0009328 ***\nResiduals            53 12                         \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Save the fitted values\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\ndata = cbind(data,fit.m2 = m2$fitted.values)\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       X              idno            bwt             age       \n Min.   : 1.00   Min.   : 1.00   Min.   : 90.0   Min.   :2.000  \n 1st Qu.: 4.75   1st Qu.: 4.75   1st Qu.:105.0   1st Qu.:3.000  \n Median : 8.50   Median : 8.50   Median :120.0   Median :3.000  \n Mean   : 8.50   Mean   : 8.50   Mean   :120.3   Mean   :3.312  \n 3rd Qu.:12.25   3rd Qu.:12.25   3rd Qu.:126.2   3rd Qu.:4.000  \n Max.   :16.00   Max.   :16.00   Max.   :160.0   Max.   :5.000  \n      sbp            fit.m1          fit.m2     \n Min.   :77.00   Min.   :76.08   Min.   :76.08  \n 1st Qu.:82.75   1st Qu.:82.87   1st Qu.:82.87  \n Median :88.50   Median :88.07   Median :88.07  \n Mean   :88.06   Mean   :88.06   Mean   :88.06  \n 3rd Qu.:92.75   3rd Qu.:92.79   3rd Qu.:92.79  \n Max.   :98.00   Max.   :98.21   Max.   :98.21  \n```\n:::\n:::\n\n\n## Compare the output from m1 and m2, what is the same? what is different? \n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nsummary(m1)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Estimate  Std. Error    t value    Pr(>|t|)\n(Intercept)   2.5515809 20.83776184  0.1224499 0.904569568\nI(age * bwt) -0.1282085  0.05159272 -2.4850114 0.028693323\nI(age)       21.2872960  6.22362825  3.4203997 0.005074825\nI(bwt)        0.5512330  0.17373097  3.1729116 0.008026120\n```\n:::\n\n```{.r .cell-code}\nsummary(m2)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   Estimate Std. Error    t value     Pr(>|t|)\n(Intercept)      88.2903706 0.53213715 165.916570 1.544073e-21\nI(age.c * bwt.c) -0.1282085 0.05159272  -2.485011 2.869332e-02\nI(age.c)          5.8622095 0.57536064  10.188757 2.925058e-07\nI(bwt.c)          0.1265423 0.02904168   4.357266 9.328388e-04\n```\n:::\n:::\n\n\n## Compare the output from m1 and m2, what is the same? what is different? \n\n::: {.cell mysize='true'}\n\\scriptsize\n\n```{.r .cell-code}\nrbind(data.frame(SeqSS.m1),data.frame(SeqSS.m2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 Df    Sum.Sq    Mean.Sq    F.value       Pr..F.\nI(age * bwt)      1 563.17274 563.172743 128.104944 9.252455e-08\nI(age)            1  10.75258  10.752575   2.445889 1.438088e-01\nI(bwt)            1  44.25799  44.257989  10.067368 8.026120e-03\nResiduals        12  52.75419   4.396183         NA           NA\nI(age.c * bwt.c)  1  29.82506  29.825065   6.784310 2.302678e-02\nI(age.c)          1 504.89335 504.893347 114.848126 1.686879e-07\nI(bwt.c)          1  83.46490  83.464895  18.985766 9.328388e-04\nResiduals1       12  52.75419   4.396183         NA           NA\n```\n:::\n\n```{.r .cell-code}\nrbind(data.frame(ParSS.m1)[-1,],data.frame(ParSS.m2)[-1,])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    Sum.Sq Df    F.value       Pr..F.\nI(age * bwt)      27.14767  1   6.175282 2.869332e-02\nI(age)            51.43153  1  11.699134 5.074825e-03\nI(bwt)            44.25799  1  10.067368 8.026120e-03\nResiduals         52.75419 12         NA           NA\nI(age.c * bwt.c)  27.14767  1   6.175282 2.869332e-02\nI(age.c)         456.37107  1 103.810761 2.925058e-07\nI(bwt.c)          83.46490  1  18.985766 9.328388e-04\nResiduals1        52.75419 12         NA           NA\n```\n:::\n:::\n\n\n## Verify the models are numerically equivalent\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       X              idno            bwt             age       \n Min.   : 1.00   Min.   : 1.00   Min.   : 90.0   Min.   :2.000  \n 1st Qu.: 4.75   1st Qu.: 4.75   1st Qu.:105.0   1st Qu.:3.000  \n Median : 8.50   Median : 8.50   Median :120.0   Median :3.000  \n Mean   : 8.50   Mean   : 8.50   Mean   :120.3   Mean   :3.312  \n 3rd Qu.:12.25   3rd Qu.:12.25   3rd Qu.:126.2   3rd Qu.:4.000  \n Max.   :16.00   Max.   :16.00   Max.   :160.0   Max.   :5.000  \n      sbp            fit.m1          fit.m2     \n Min.   :77.00   Min.   :76.08   Min.   :76.08  \n 1st Qu.:82.75   1st Qu.:82.87   1st Qu.:82.87  \n Median :88.50   Median :88.07   Median :88.07  \n Mean   :88.06   Mean   :88.06   Mean   :88.06  \n 3rd Qu.:92.75   3rd Qu.:92.79   3rd Qu.:92.79  \n Max.   :98.00   Max.   :98.21   Max.   :98.21  \n```\n:::\n:::\n\n\n## Interpretation in uncentered and centered models.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nsummary(lm(sbp~age*bwt))$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Estimate  Std. Error    t value    Pr(>|t|)\n(Intercept)  2.5515809 20.83776184  0.1224499 0.904569568\nage         21.2872960  6.22362825  3.4203997 0.005074825\nbwt          0.5512330  0.17373097  3.1729116 0.008026120\nage:bwt     -0.1282085  0.05159272 -2.4850114 0.028693323\n```\n:::\n\n```{.r .cell-code}\nsummary(lm(sbp~age.c*bwt.c))$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Estimate Std. Error    t value     Pr(>|t|)\n(Intercept) 88.2903706 0.53213715 165.916570 1.544073e-21\nage.c        5.8622095 0.57536064  10.188757 2.925058e-07\nbwt.c        0.1265423 0.02904168   4.357266 9.328388e-04\nage.c:bwt.c -0.1282085 0.05159272  -2.485011 2.869332e-02\n```\n:::\n:::\n\n+ (1) Give interpretations for the main effect coefficient for AGE \n+ (2) Interpret the interaction\n\n\n## (1) Give interpretations for the main effect coefficient for AGE \n\n## (2) Interpret the interaction\n\n## Dichotomize BWT. Refit the interaction model.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nhighbwt = 1*(bwt > mean(bwt)) #1*(bwt.c > 0)\nmgrp = lm(sbp~age*highbwt)\nsummary(mgrp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = sbp ~ age * highbwt)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-5.2353 -1.2452 -0.7353  1.8750  4.3235 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  64.9118     3.2693  19.855 1.52e-10 ***\nage           6.4412     0.9759   6.600 2.54e-05 ***\nhighbwt       8.4882     5.1498   1.648    0.125    \nage:highbwt  -1.2662     1.4872  -0.851    0.411    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.683 on 12 degrees of freedom\nMultiple R-squared:  0.8713,\tAdjusted R-squared:  0.8391 \nF-statistic: 27.08 on 3 and 12 DF,  p-value: 1.257e-05\n```\n:::\n:::\n\n\n## Scatterplot with subjects stratified by age category\n\n::: {.cell mysize='true'}\n\\scriptsize\n\n```{.r .cell-code}\nplot(age[highbwt == 0], sbp[highbwt == 0], pch = 15, col=\"black\",\n     xlab = \"Age (years)\", ylab = \"SBP (mm Hg)\",xlim=range(age),ylim=range(sbp))\npoints(age[highbwt == 1], sbp[highbwt == 1], pch = 16, col=\"red\")\nlines(age[highbwt == 0],mgrp$fitted.values[highbwt == 0],col=\"black\")\nlines(age[highbwt == 1],mgrp$fitted.values[highbwt == 1],col=\"red\")\nlegend(\"bottomright\",bty=\"n\",legend=c(\"higher bwt\",\"lower bwt\"),\n       col=c(\"red\",\"black\"),pch=c(16,15))\n```\n\n::: {.cell-output-display}\n![](11_Interactions_files/figure-revealjs/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n\n\n## Fit regression by subgroup\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nmgrp1 = lm(sbp~age,data=data.frame(sbp,age)[highbwt==1,])\nmgrp0 = lm(sbp~age,data=data.frame(sbp,age)[highbwt==0,])\nsummary(mgrp)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Estimate Std. Error    t value     Pr(>|t|)\n(Intercept) 64.911765  3.2693233 19.8548012 1.518613e-10\nage          6.441176  0.9759295  6.6000429 2.537604e-05\nhighbwt      8.488235  5.1497686  1.6482751 1.252107e-01\nage:highbwt -1.266176  1.4872033 -0.8513809 4.112259e-01\n```\n:::\n\n```{.r .cell-code}\nsummary(mgrp1)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error   t value     Pr(>|t|)\n(Intercept)   73.400  3.4989999 20.977423 4.560651e-06\nage            5.175  0.9868511  5.243952 3.342896e-03\n```\n:::\n\n```{.r .cell-code}\nsummary(mgrp0)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Estimate Std. Error   t value     Pr(>|t|)\n(Intercept) 64.911765   3.524068 18.419555 3.445266e-07\nage          6.441176   1.051974  6.122945 4.801170e-04\n```\n:::\n:::\n\n\n## Fit regression by subgroup\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nrbind( mgrp0=coef(mgrp0), mgrp=coef(mgrp)[c(\"(Intercept)\",\"age\")] )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      (Intercept)      age\nmgrp0    64.91176 6.441176\nmgrp     64.91176 6.441176\n```\n:::\n\n```{.r .cell-code}\nrbind( mgrp1=coef(mgrp1), \n   mgrp=c(\n   coef(mgrp)[\"(Intercept)\"]+coef(mgrp)[\"highbwt\"],\n   coef(mgrp)[\"age\"]+coef(mgrp)[\"age:highbwt\"]\n   )\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      (Intercept)   age\nmgrp1        73.4 5.175\nmgrp         73.4 5.175\n```\n:::\n:::\n\n\n\n## Get 95% CI for age effect among high BWT subjects.\n\n::: {.cell mysize='true'}\n\\footnotesize\n\n```{.r .cell-code}\nmgrp = lm(sbp~age*highbwt)\nvcov(mgrp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            (Intercept)        age    highbwt age:highbwt\n(Intercept)   10.688475 -3.0689681 -10.688475   3.0689681\nage           -3.068968  0.9524384   3.068968  -0.9524384\nhighbwt      -10.688475  3.0689681  26.520117  -7.3866887\nage:highbwt    3.068968 -0.9524384  -7.386689   2.2117735\n```\n:::\n\n```{.r .cell-code}\nage.eff = c(  c(0,1,0,1)%*%coef(mgrp)  )\nage.var = c(  c(0,1,0,1)%*%vcov(mgrp)%*%c(0,1,0,1)  )\nt = qt(p=0.975,df=nrow(data)-4) #or qnorm(0.975) if n=nrow(data) is large\n(age.confint = age.eff + c(-1,1)*t*sqrt(age.var))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.729934 7.620066\n```\n:::\n\n```{.r .cell-code}\nconfint(mgrp1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                2.5 %    97.5 %\n(Intercept) 64.405535 82.394465\nage          2.638219  7.711781\n```\n:::\n:::\n\n\n## Shifting Covariates in Main Effects Model\n\nMain effects model: $E[Y_i]=\\beta_0 + \\beta_1X_{i1} + \\beta_2X_{i2}$\n\nShifting Covariates: set $X_{i1}^*=X_{i1}-a$, $X_{i2}^*=X_{i2}-b$\n\nRevised model: $$\\begin{aligned}\n        E[Y_i] & = &\\beta_0^* + \\beta_1^*X_{i1}^* + \\beta_2^*X_{i2}^*\n        \\nonumber \\\\ & = & \\beta_0^* + \\beta_1^*(X_{i1}-a) +\n        \\beta_2^*(X_{i2}-b)\n        \\nonumber\n    \n\\end{aligned}$$\n\nExamining the parameters: $$\\begin{aligned}\n        \\beta_1^* & = & \\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}}\n        \\;\\;\\;(=\\beta_1)\\nonumber \\\\\n        \\beta_2^* & = & \\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i2}}\n        \\;\\;\\;(=\\beta_2) \\nonumber \\\\\n        \\beta_0^* & = &\n        E[Y_i|X_{i1}=a,X_{i1}=b] \\;(\\neq \\beta_0:  E[Y_i|X_{i1}=0,X_{i1}=0]) \\nonumber\n    \n\\end{aligned}$$\n\nTherefore, in the *main effects* model shifting covariates impacts the\nintercept, but not the regression parameters $\\{\\beta_j;j>0\\}$\n\n## Shifting Covariates in Interaction Model\n\nInteraction model:\n$E[Y_i]=\\beta_0 + \\beta_1X_{i1} + \\beta_2X_{i2}+ \\beta_3X_{i1}X_{i2}$\n\nShifting Covariates: set $X_{i1}^*=X_{i1}-a$, $X_{i2}^*=X_{i2}-b$\n\nRevised model: $$\\begin{aligned}\n        E[Y_i] &= & \\beta_0^* + \\beta_1^*X_{i1}^* + \\beta_2^*X_{i2}^* +\n        \\beta_3^*X_{i1}^*X_{i2}^* \\nonumber \\\\ \n        & = &\n        \\beta_0^* + \\beta_1^*(X_{i1}-a) + \\beta_2^*(X_{i2}-b) + \\beta_3^*(X_{i1}-a)(X_{i2}-b)\n        \\nonumber\n    \n\\end{aligned}$$ Examining the parameters: Clearly,\n$\\beta_0^*\\neq \\beta_0$\n$\\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}} = \\beta_1^* +\n    \\beta_3^*(X_{i2}-b)\\Rightarrow \\beta_1^*\\stackrel{\\tiny \\mbox{when $X_{i2}\\!=\\!b$}}{=\\!\\longeq\\!=}\\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}}$\nrecall:\n$\\beta_1\\stackrel{\\tiny \\mbox{when $X_{i2}\\!=\\!0$}}{=\\!\\longeq\\!=}\\frac{\\partial E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}}$,\ntherefore $\\beta_1^*\\neq \\beta_1$ (unless $b=0$) Similarly,\n$\\beta_2^*\\neq \\beta_2$ However,\n$\\beta_3^* = \\frac{\\partial^2 E[Y_i\\mid X_{i1},X_{i2}]}{\\partial X_{i1}\\partial\n        X_{i2}} = \\beta_3$\n\nTherefore, in the *interaction* model shifting covariates impacts\neverything but the interaction parameters\n\n## Interpretation in Interaction Model\n\nConclusion: interaction coefficient does not depend on\nshifting/centering\n\nIn a model with interaction, interpret the main effect with caution: you\nneed to know where the covariates are centered and this centering value\nshould be meaningful to your data\\\nFor example:\n$SBP_i = \\beta_0 + \\beta_1 A_i + \\beta_2 F_i + \\beta_3 A_iF_i +\n    \\epsilon_i$\n\n$\\beta_1=$ $\\beta_2=$\n\n",
    "supporting": [
      "11_Interactions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "e4360f57783fb353845453e5d2cee5ca",
  "result": {
    "markdown": "---\ntitle: \"Prediction Bands\"\nauthor: \"Meike Niederhausen\"\ndate: \"BSTA 512/612\"\noutput:\n  html_document:\n    number_sections: yes\n    toc: yes\n    toc_float:\n      collapsed: yes\n      smooth_scroll: no\n    theme: cerulean\n    self_contained: true\neditor_options: \n  chunk_output_type: console\n  markdown: \n    wrap: 72\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Note that the R chunk includes `message = FALSE` and `warning=FALSE` in the first line. \n# This is so that the messages & warnings that appear when loading the packages don't show up in the knitted html file.\n\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(knitr)\nlibrary(broom)\nlibrary(rstatix)\nlibrary(gt)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngapm <- read_csv(\"data/lifeexp_femlit_2011.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 188 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): country\ndbl (2): life_expectancy_years_2011, female_literacy_rate_2011\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n# Fit regression model:\nmodel1 <- lm(life_expectancy_years_2011 ~ female_literacy_rate_2011,\n             data = gapm)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata <- data.frame(female_literacy_rate_2011 = 60) \nnewdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  female_literacy_rate_2011\n1                        60\n```\n:::\n\n```{.r .cell-code}\npredict(model1, \n        newdata=newdata, \n        interval=\"confidence\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       fit      lwr      upr\n1 64.85961 62.93335 66.78586\n```\n:::\n:::\n\n\n# Prediction of new value of Y at $X_0$ (Section 5.10)\n\n-   We can use the regression equation to predict values of Y given X.\n    -   Regression equation for our model:\n\n$$\\widehat{\\textrm{life expectancy}} = 50.9 + 0.232 \\cdot \\textrm{female literacy rate} $$\n\n-   What do we predict a country's life expectancy to be when its female literacy rate is 60?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(Y_X0 <- 50.9 + 0.232*60)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 64.82\n```\n:::\n:::\n\n\n## Prediction interval for predicting individual values\n\n-   We do not call this interval a CI since Y is a random variables instead of a parameter\n-   The form is similar to a CI though:\n\n$$\\widehat{Y}_{X_0} \\pm t_{n-2}^* \\cdot s_{Y|X} \\sqrt{1 + \\frac{1}{n} + \\frac{(x_0 - \\bar{x})^2}{(n-1)s_x^2}}$$\n\n-   Note that the only difference to the CI for a mean value of y is the additional `1+` under the square root.\n    -   Thus the width is wider!\n\n### Example: Prediction interval\n\n**Find the 95% prediction interval for the life expectancy when the female literacy rate is 60.**\n\n$$\\widehat{Y}_{X_0} \\pm t_{n-2}^* \\cdot s_{Y|X} \\sqrt{1 + \\frac{1}{n} + \\frac{(x_0 - \\bar{x})^2}{(n-1)s_x^2}}\\\\\n64.82 \\pm 1.990847 \\cdot 6.142157 \\sqrt{1+\\frac{1}{80} + \\frac{(60 - 81.65375)^2}{(80-1)21.95371^2}}\\\\\n(52.44112, 77.19888)$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(Y_X0 <- 50.9 + 0.232*60)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 64.82\n```\n:::\n\n```{.r .cell-code}\n(tstar <- qt(.975, df = 78))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.990847\n```\n:::\n\n```{.r .cell-code}\nsd(gapm$female_literacy_rate_2011, na.rm = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 21.95371\n```\n:::\n\n```{.r .cell-code}\nmean(gapm$female_literacy_rate_2011, na.rm = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 81.65375\n```\n:::\n\n```{.r .cell-code}\n(pred_SE_Y_X0 <- 6.142157 *sqrt(1 + 1/80 + (60 - 81.65375)^2/((80-1)*21.95371^2)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6.217898\n```\n:::\n\n```{.r .cell-code}\n(pred_MOE_Y_X0 <- pred_SE_Y_X0*tstar)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 12.37888\n```\n:::\n\n```{.r .cell-code}\nY_X0 - pred_MOE_Y_X0\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 52.44112\n```\n:::\n\n```{.r .cell-code}\nY_X0 + pred_MOE_Y_X0\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 77.19888\n```\n:::\n:::\n\n\n### Using R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  female_literacy_rate_2011\n1                        60\n```\n:::\n\n```{.r .cell-code}\npredict(model1, \n        newdata=newdata, \n        interval=\"prediction\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       fit      lwr      upr\n1 64.85961 52.48072 77.23849\n```\n:::\n:::\n\n\n### Prediction bands\n\nCreate a scatterplot with the regression line, 95% confidence bands, and 95% prediction bands.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"coefficients\"  \"residuals\"     \"effects\"       \"rank\"         \n [5] \"fitted.values\" \"assign\"        \"qr\"            \"df.residual\"  \n [9] \"na.action\"     \"xlevels\"       \"call\"          \"terms\"        \n[13] \"model\"        \n```\n:::\n\n```{.r .cell-code}\n# data used to create the regression model are stored in `model`\n# Useful since rows with missing values already removed\nhead(model1$model)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  life_expectancy_years_2011 female_literacy_rate_2011\n1                       56.7                      13.0\n2                       76.7                      95.7\n5                       60.9                      58.6\n6                       76.9                      99.4\n7                       76.0                      97.9\n8                       73.8                      99.5\n```\n:::\n\n```{.r .cell-code}\npred <- predict(model1, \n                interval=\"prediction\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in predict.lm(model1, interval = \"prediction\"): predictions on current data refer to _future_ responses\n```\n:::\n\n```{.r .cell-code}\nhead(pred)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       fit      lwr      upr\n1 53.94643 40.91166 66.98121\n2 73.14897 60.81324 85.48470\n5 64.53453 52.14572 76.92334\n6 74.00809 61.65365 86.36253\n7 73.65980 61.31347 86.00613\n8 74.03131 61.67631 86.38632\n```\n:::\n\n```{.r .cell-code}\n# cbind is column bind to merge datasets together\ndata_pred_bands <- cbind(model1$model, pred)\nglimpse(data_pred_bands)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 80\nColumns: 5\n$ life_expectancy_years_2011 <dbl> 56.7, 76.7, 60.9, 76.9, 76.0, 73.8, 71.0, 7…\n$ female_literacy_rate_2011  <dbl> 13.0, 95.7, 58.6, 99.4, 97.9, 99.5, 53.4, 9…\n$ fit                        <dbl> 53.94643, 73.14897, 64.53453, 74.00809, 73.…\n$ lwr                        <dbl> 40.91166, 60.81324, 52.14572, 61.65365, 61.…\n$ upr                        <dbl> 66.98121, 85.48470, 76.92334, 86.36253, 86.…\n```\n:::\n\n```{.r .cell-code}\nggplot(data_pred_bands, \n       aes(x=female_literacy_rate_2011,\n           y=life_expectancy_years_2011)) +\n  geom_point() +\n  geom_smooth(method=lm) +\n  geom_line(aes(y=lwr), \n            color=\"violet\", \n            linetype=\"dashed\")+\n  geom_line(aes(y=upr), \n            color=\"violet\", \n            linetype=\"dashed\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](Slack_Pred_bands_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Slack_Pred_bands_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
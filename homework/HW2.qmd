---
title: "Homework 2"
subtitle: "BSTA 512/612"
description: "Due: Thursday February 1, 2024"
date-modified: "12/22/2024"
date: "2/1/2024"
categories: [""]
format: 
  html:
    link-external-newwindow: true
    toc: true
    self-contained: true
  pdf: default 
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.height = 2, fig.width = 4)

library(tidyverse)
library(rstatix)
library(broom)
library(gt)
library(janitor)
library(readxl)
library(haven)
library(here)

```

::: callout-important
**THIS PAGE IS UNDER CONSTRUCTION!! It's likely that I will be making changes to this assignment at this time!**
:::

## Directions

-   [Download the `.qmd` file here.](https://github.com/nwakim/W2024_BSTA_512/blob/main/homework/HW2.qmd)

-   You will need to download the datasets. Use [this link to download](https://ohsuitg-my.sharepoint.com/:f:/r/personal/wakim_ohsu_edu/Documents/Teaching/Classes/W2024_BSTA_512_612/Student_files/Data/Homework?csf=1&web=1&e=QEsqb9) the homework datasets needed in this assignment. If you do not want to make changes to the paths set in this document, then make sure the files are stored in a folder named "data" that is housed in the same location as this homework `.qmd` file.

-   Please upload your homework to [Sakai](https://sakai.ohsu.edu/portal/site/BSTA-512-1-AB-W24/tool/961ec5ef-d7f9-4518-be16-25f7af3d6be4). **Upload both your `.qmd` code file and the rendered `.html` file**

-   For each question, make sure to include all code and resulting output in the html file to support your answers.

-   Show the work of your calculations using R code within a code chunk. Make sure that both your code and output are visible in the rendered html file. This is the default setting.

-   If you are computing something by hand, you may take a picture of your work and insert the image in this file. You may also use LaTeX to write it inline.

-   Write all answers in complete sentences as if communicating the results to a collaborator. This means including a sentence summarizing results in the context of the research study.

    -   Questions **not requiring a sentence are**
        -   Ch 7 \# 1, 2, 5
        -   Ch 6 \# 5, 6
        -   Ch 14 \# 2, 12, 14

::: callout-tip
It is a good idea to try rendering your document from time to time as you go along! Note that rendering automatically saves your qmd file and rendering frequently helps you catch your errors more quickly.
:::

## Question 1

This homework assignment is based on data collected as part of an observational study of patients who suffered from stroke.

Dataset: The main goal was to study various psychological factors: optimism, fatalism, depression, spirituality, and their relationship with stroke severity and other health outcomes among the study participants. Data were collected using questionnaires during a baseline interview and also medical chart review. More information about this study can be found in the article [Fatalism, optimism, spirituality, depressive symptoms and stroke outcome: a population based analysis](https://pubmed.ncbi.nlm.nih.gov/21940963/).

The dataset that you will work with is called `completedata.sas7bdat`. It is SIMILAR but does not exactly match the data in the article. It contains information on complete cases (i.e. excludes participants who had missing data on one or more variables of interest) who suffered a stroke. The two variables we are interested in are:

-   Covariate: `Fatalism` (larger values indicate that the individual feels less control of their life)

    -   Scores range from 8 to 40

-   Outcome: `Depression` (larger values imply increased depression)

    -   Scores range from 0 to 27

For our homework purposes we will assume they are continuous.

```{r}
fatal_dep = read_sas(here("./homework/data/completedata.sas7bdat"))
```

### Part a

Plot the data, with title and axis labels, for Depression (y-axis) vs. Fatalism (x-axis). Comment on what you see.

### Part b

Fit a linear regression model to estimate the association between the predictor Fatalism and the outcome Depression.

Interpret the slope and intercept. Does the intercept make sense?

::: callout-note
Make sure to include the confidence interval. The "units" for fatalism and depression are scores.
:::

### Part c

Obtain the interquartile range (IQR) for fatalism (IQR is Q3-Q1). Make a new variable FatalismIQR, equal to Fatalism centered at its median, and divided by the IQR. This is one way of standardizing a variable, and can be used for variables that have symmetric or skewed distribution.

Re-run the regression from Part b using this new variable. Interpret the new slope and intercept. Which of the following are the same as in 1b: intercept, slope?

### Part d

F-test???

## Question 2

This question and data are adapted from [this textbook](https://catalog.lib.uchicago.edu/vufind/Record/7546272).

In an experiment designed to describe the doseâ€“response curve for vitamin K, individual rats were depleted of their vitamin K reserves and then fed dried liver for 4 days at different dosage levels. The response of each rat was measured as the concentration of a clotting agent needed to clot a sample of its blood in 3 minutes. The results of the experiment on 12 rats are given in the following table; values are expressed in common logarithms for both dose and response.

```{r}
clot = read_excel(here("./homework/data/CH05Q09.xls"))
clot %>% gt() %>%
  cols_label(RAT = md("**Rat**"),
             LOGCONC = md("**Log10 Concentration (Y)**"),
             LOGDOSE = md("**Log10 Dose (X)**"))
```

Use the log-transformed values as given in the dataset.

Use the following scatterplot to build your answers off of:

```{r}
#| fig-height: 5
#| fig-width: 6.5
#| fig-align: center
#| echo: false

ggplot(clot, aes(x = LOGDOSE,
                 y = LOGCONC)) +
  geom_point(size = 2) +
  labs(x = "Log10 dose (X)", 
       y = "Log10 concentration (Y)",
       title = "Concentration of clotting agent needed vs. dosage levels of liver") +
    theme(axis.title = element_text(size = 12), 
        axis.text = element_text(size = 12), 
        title = element_text(size = 12))
```

### Part a

Fit the data and add the regression line onto the plot.

### Part b

Use R to create the ANOVA table for the regression described in the exercise.

### Part c

Using the values in the `Df` and `Sum Sq` columns, show how the remaining values in the table are calculated.

### Part d

Calculate the SSY and its degrees of freedom. Use these values to calculate the standard deviation of the outcome variable.

### Part e

What are the hypotheses being tested in the ANOVA table? Make sure to include a description of the parameter being tested in the context of the research question.

### Part f

Using just the values in the ANOVA table, find the value of the t-distribution test statistic for testing the slope that one would find in the regression output of the linear model. What are the degrees of freedom for that t-distribution?

### Part g

Show the regression output for the linear model. Using just the regression output, calculate the SSR and SSE values in the ANOVA table.

## Question 1 (chapter 6)

Use the data from Chapter 5 Question 9 to answer the following questions. Use the log-transformed values as given in the dataset.

### (2)

Find the correlation coefficient between the two variables. Is the value consistent with your description of the relationship in the previous question? Why or why not?

### (3)

Test whether the two variables are significantly correlated. Do this using the formula and then check your work with R's test for correlations. Make sure to include the hypotheses and a conclusion.

### (4)

Calculate the confidence interval for $\rho$ using the formula and verify that it matches the confidence interval in R's test output. Include an interpretation of the confidence interval and also explain why the confidence interval is consistent with the p-value.

### (5)

Calculate the coefficient of determination using the ANOVA table output, and confirm that it matches the value in the R output (what R output shows this and what is it labeled as?).

### (6)

What is another way to calculate the coefficient of determination? Do the calculation and verify that you have the same answer.

### (7)

Give an interpretation of the coefficient of determination in the context of the study.

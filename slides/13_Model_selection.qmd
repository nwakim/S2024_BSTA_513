---
title: "Lesson 13: Model/Variable Selection"
author: "Nicky Wakim"
title-slide-attributes:
    data-background-color: "#213c96"
date: "02/26/2024"
categories: ["Week 8"]
format: 
  revealjs:
    theme: [default, simple_NW.scss]
    chalkboard: true
    slide-number: true
    show-slide-number: all
    width: 1955
    height: 1100
    footer: Model Selection
    html-math-method: mathjax
    highlight-style: ayu
execute:
  freeze: auto  # re-render only when source changes
---

```{r}
#| label: "setup" 
#| include: false
#| message: false
#| warning: false

library(tidyverse)
library(janitor)
library(knitr)
library(broom)
library(rstatix)
library(gt)
library(readxl)
#----------
# new packages
# install.packages("describedata")
library(describedata) # gladder()
library(gridExtra)   # grid.arrange()
library(ggfortify)  # autoplot(model)
# New Day 6
library(gtsummary)

# New Day 7
library(plotly) # for plot_ly() command
library(GGally) # for ggpairs() command 
library(ggiraphExtra)   # for ggPredict() command

# Load the data - update code if the csv file is not in the same location on your computer
# If you need to download the file, please go to ur shared folder under Data > Slides
gapm <- read_excel("data/Gapminder_vars_2011.xlsx", 
                   na = "NA")  # important!!!! 


gapm_sub <- gapm %>% # called it gapm2_sub3 to be consistent with Day 7 notes
  drop_na(LifeExpectancyYrs, FemaleLiteracyRate, four_regions, FoodSupplykcPPD) %>%
  mutate(four_regions = factor(four_regions, 
                               levels = c("africa", "americas", 
                                          "asia", "europe"), 
                               labels = c("Africa", "Americas", 
                                          "Asia", "Europe"))) %>%
  rename(income_levels = `World bank, 4 income groups 2017`) %>%
  mutate(income_levels1 = factor(income_levels, 
                                levels = c("Low income", 
                                           "Lower middle income", 
                                           "Upper middle income", 
                                           "High income")), 
         income_levels2 = relevel(factor(income_levels, 
                                levels = c("Low income", 
                                           "Lower middle income", 
                                           "Upper middle income", 
                                           "High income"), 
                                labels = c("Lower income", "Lower income", 
                                            "Higher income", "Higher income")), 
                                ref = "Lower income"))
gapm_ind = gapm_sub %>% select(LifeExpectancyYrs, country)
```

# Learning Objective

## Why can't I just throw in all the variables into my model?

-   First, let's think about the number of observations in our dataset

    -   For example: In the Gapminder dataset, I can use an indicator for each country

    -   Remember that each country is its own observation

    -   

## Bias-variance trade off

## Model Selection basics (slide adjusted from Jodi Lapidus)

-   "Because models always fall far short of the complex reality under study, there are no best or optimal strategies for modeling."

    -   From: [Statistical Foundations for Model-Based Adjustments](https://www.annualreviews.org/doi/pdf/10.1146/annurev-publhealth-031914-122559)

-   Not all statistical texts provide practical advice on model development

    -   Moore text includes methods/code to compare models, but does not include much advice re: selecting which model to ultimately use.
    -   Other texts are sparse on details or incorporate simplistic approaches

-   Model development strategy should **align with research goals**

    -   Prediction vs. Estimating Association
    -   Strategy may depend on study design and data set size

## The goals of association vs. prediction

::: columns
::: column
::: definition
::: def-title
Association / Explanatory / One variable's effect
:::

::: def-cont
-   **Goal:** Understand one variable's (or a group of variable's) effect on the response after adjusting for other factors

-   Only interpret the coefficient of the variable that is the focus of the study

    -   Interpreting the coefficients of the other variables is not important

-   Any variables not selected for the final model have still been adjusted for, since they had a chance to be in the model
:::
:::
:::

::: column
::: proposition
::: prop-title
Prediction
:::

::: prop-cont
-   **Goal:** to calculate the most precise prediction of the response variable

-   Interpreting coefficients is not important

-   Choose only the variables that are strong predictors of the response variable

    -   Excluding irrelevant variables can help reduce widths of the prediction intervals
:::
:::
:::
:::

## Model building for association vs. prediction

[More information on the two analysis goals:](https://onlinelibrary.wiley.com/doi/10.1016/j.pmrj.2014.08.941)

![](13_Model_selection/explanatory_v_prediction.png){fig-align="center"}

[If you ever get the chance, check out Dr. Kristin Sainani's series on Statistics](https://onlinelibrary.wiley.com/authored-by/Sainani/Kristin+L.?startPage=&SeriesKey=19341563)

## Model selection strategies (slide adjusted from Jodi Lapidus)

-   Pre-specification of multivariable model

-   Purposeful model selection (Categorical data analysis)

    -   "Risk factor modeling"

-   Automated strategies

    -   You'll see these a lot, but they're not really good methods: Backward/forward/stepwise selection
    -   

-   Change in Estimate (CIE) approaches

## General process for association

Model selection methods, for the purpose of association, generally consist of the same essential steps:

1.  Construct a list of all candidate covariates
2.  

## Some model selection criteria
